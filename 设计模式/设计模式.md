# 1ã€è®¾è®¡æ¨¡å¼ä¸ƒå¤§åŸåˆ™

**è®¾è®¡æ¨¡å¼ä½“ç°äº†ä»£ç çš„è€¦åˆæ€§ï¼Œ å†…èšæ€§ä»¥åŠå¯ç»´æŠ¤æ€§ï¼Œå¯æ‰©å±•æ€§ï¼Œé‡ç”¨æ€§ï¼Œçµæ´»æ€§ã€‚**

- **1ã€ä»£ç é‡ç”¨æ€§ï¼ˆå³ï¼šç›¸åŒåŠŸèƒ½çš„ä»£ç ï¼Œä¸ç”¨å¤šæ¬¡ç¼–å†™ï¼‰**
- **2ã€å¯è¯»æ€§ï¼ˆå³ï¼šç¼–ç¨‹è§„èŒƒæ€§ï¼Œä¾¿äºå…¶ä»–ç¨‹åºå‘˜çš„é˜…è¯»å’Œç†è§£ï¼‰**
- **3ã€å¯æ‰©å±•æ€§ï¼ˆå³ï¼šå½“éœ€è¦å¢åŠ æ–°çš„åŠŸèƒ½æ—¶ï¼Œéå¸¸çš„æ–¹ä¾¿ï¼Œç§°ä¸ºå¯ç»´æŠ¤ï¼‰**
- **4ã€å¯é æ€§ï¼ˆå³ï¼šå½“æˆ‘ä»¬å¢åŠ æ–°çš„åŠŸèƒ½åï¼Œå¯¹åŸæ¥çš„åŠŸèƒ½æ²¡æœ‰å½±å“ï¼‰**
- **5ã€ä½¿ç¨‹åºå‘ˆç°`é«˜å†…èšï¼Œä½è€¦åˆ`çš„ç‰¹æ€§**

**`Scott Mayersåœ¨å…¶å·¨è‘—ã€ŠEffective C++ã€‹è¯´è¿‡: C++è€æ‰‹å’ŒC++æ–°æ‰‹çš„åŒºåˆ«å°±æ˜¯å‰è€…æ‰‹èƒŒä¸Šæœ‰å¾ˆå¤šä¼¤ç–¤ã€‚`**

- **åŒæ ·æ˜¯é¢å‘å¯¹è±¡ï¼Œå½“ç„¶ä¹Ÿå¯æŒ‡ Java**

## ä¸€ã€å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle responsibilityï¼‰

**å•ä¸€èŒè´£åŸåˆ™æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚ï¼š**

- **1ã€é™ä½ç±»çš„å¤æ‚åº¦ï¼Œä¸€ä¸ªç±»åªè´Ÿè´£ä¸€é¡¹èŒè´£ï¼›**
- **2ã€æé«˜ç±»çš„å¯è¯»æ€§ï¼Œå¯ç»´æŠ¤æ€§ï¼›**
- **3ã€é™ä½å˜æ›´å¼•èµ·çš„é£é™©**;
- **4ã€é€šå¸¸æƒ…å†µä¸‹ï¼Œåº”å½“éµå®ˆå•ä¸€èŒè´£åŸåˆ™ï¼Œ åªæœ‰é€»è¾‘è¶³å¤Ÿç®€å•ï¼Œæ‰å¯ä»¥åœ¨æ–¹æ³•çº§è¿åå•ä¸€èŒè´£åŸåˆ™**ã€‚

```java
/**
 * åªæœ‰ç±»ä¸­æ–¹æ³•æ•°é‡è¶³å¤Ÿå°‘ï¼Œå¯ä»¥åœ¨æ–¹æ³•çº§åˆ«ä¿æŒå•ä¸€èŒè´£åŸåˆ™
 */
public class Singleresponsibility {
    public static void main(String[] args) {
        Vehicle vehicle = new Vehicle();
        vehicle.run("è·‘è·‘å¡ä¸è½¦");
        vehicle.fly("ç›´å‡é£æœº");
    }
}

//äº¤é€šå·¥å…·ç±»
// é€»è¾‘ç®€å•ï¼Œæ–¹æ³•çº§åˆ«å®ç°å•ä¸€èŒè´£
// é€»è¾‘å¤æ‚ï¼Œåˆ†ç±»å®ç°å•ä¸€èŒè´£
class Vehicle{
    public void run(String vehicle){
        System.out.println(vehicle+"åœ¨é™†åœ°ä¸Šè·‘");
    }
    public void fly(String vehicle){
        System.out.println(vehicle+"åœ¨å¤©ç©ºä¸Šé£");
    }
}
```

##  äºŒã€æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregationï¼‰

- **1ã€ç±»Aé€šè¿‡æ¥å£ Interface1ã€2 ä¾èµ–ç±»Bï¼Œç±»Cé€šè¿‡æ¥å£ Interface1ã€3 ä¾èµ–ç±»Dï¼Œå¦‚æœæ¥å£ Interface å¯¹äº ç±»A å’Œ ç±»C æ¥è¯´ä¸æ˜¯æœ€å°æ¥å£ï¼Œé‚£ä¹ˆ ç±»B å’Œ ç±»D å¿…é¡»å»å®ç°ä»–ä»¬ä¸éœ€è¦çš„æ–¹æ³•ã€‚**
- **2ã€å°†æ¥å£ Interface æ‹†åˆ†ä¸ºç‹¬ç«‹çš„å‡ ä¸ªæ¥å£ï¼Œç±»A å’Œ ç±»C åˆ†åˆ«ä¸ä»–ä»¬éœ€è¦çš„æ¥å£å»ºç«‹ä¾èµ–å…³ç³»ã€‚ä¹Ÿå°±æ˜¯é‡‡ç”¨æ¥å£éš”ç¦»åŸåˆ™ã€‚**
- **3ã€æ¥å£ Interface ä¸­å‡ºç°çš„æ–¹æ³•ï¼Œæ ¹æ®å®é™…æƒ…ç¥æ‹†åˆ†ä¸ºä¸‰ä¸ªæ¥å£ã€‚**

![image-20200505134625867](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200505134625867.png)

```java
public class Segregation {
    public static void main(String[] args) {
        A a = new A();
        a.depent1(new B());//Aä¾èµ–B
        a.depent2(new B());
        a.depent3(new B());
        C c = new C();
        c.depent1(new D());//Cä¾èµ–D
        c.depent2(new D());
        c.depent3(new D());
    }
}

interface interface1{
    void operation1();
}

interface interface2{
    void operation2();
    void operation3();
}

interface interface3{
    void operation4();
    void operation5();
}

class B implements interface1,interface2{

    @Override
    public void operation1() {
        System.out.println("bå®ç°äº†operation1");
    }

    @Override
    public void operation2() {
        System.out.println("bå®ç°äº†operation2");
    }

    @Override
    public void operation3() {
        System.out.println("bå®ç°äº†operation3");
    }
}

class D implements interface1,interface3{
    @Override
    public void operation1() {
        System.out.println("Då®ç°äº†operation1");
    }

    @Override
    public void operation4() {
        System.out.println("Då®ç°äº†operation4");
    }

    @Override
    public void operation5() {
        System.out.println("Då®ç°äº†operation5");
    }
}

class A{
    void depent1(interface1 i){
        i.operation1();
    }
    void depent2(interface2 i){
        i.operation2();
    }
    void depent3(interface2 i){
        i.operation3();
    }
}
class C{
    void depent1(interface1 i){
        i.operation1();
    }
    void depent2(interface3 i){
        i.operation4();
    }
    void depent3(interface3 i){
        i.operation5();
    }

```

## ä¸‰ã€ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆDependence Inversionï¼‰

- **1ã€é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ï¼ˆç¼“å†²å±‚ï¼‰ï¼›**
- **2ã€æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ï¼›**
- **3ã€ä¾èµ–å€’è½¬(å€’ç½®)çš„ä¸­å¿ƒæ€æƒ³æ˜¯é¢å‘æ¥å£ç¼–ç¨‹;**
- **4ã€ä¾èµ–å€’è½¬åŸåˆ™æ˜¯åŸºäºè¿™æ ·çš„è®¾è®¡ç†å¿µï¼šç›¸å¯¹äºç»†èŠ‚çš„å¤šå˜æ€§ï¼ŒæŠ½è±¡çš„ä¸œè¥¿è¦ç¨³å®šçš„å¤šã€‚ä»¥æŠ½è±¡ä¸ºåŸºç¡€æ­å»ºçš„æ¶æ„æ¯”ä»¥ç»†èŠ‚ä¸ºåŸºç¡€çš„æ¶æ„è¦ç¨³å®šçš„å¤šã€‚åœ¨javaä¸­ï¼Œ æŠ½è±¡æŒ‡çš„æ˜¯æ¥å£æˆ–æŠ½è±¡ç±»ï¼Œç»†èŠ‚å°±æ˜¯å…·ä½“çš„å®ç°ç±»ï¼›**
- **5ã€ä½¿ç”¨æ¥å£æˆ–æŠ½è±¡ç±»çš„ç›®çš„æ˜¯åˆ¶å®šå¥½è§„èŒƒï¼Œè€Œä¸æ¶‰åŠä»»ä½•å…·ä½“çš„æ“ä½œï¼ŒæŠŠå±•ç°ç»†èŠ‚çš„ä»»åŠ¡äº¤ç»™ä»–ä»¬çš„å®ç°ç±»å»å®Œæˆã€‚**



- **ä¾èµ–å…³ç³»ä¸‰ç§ä¼ é€’æ–¹å¼ï¼š**
  - **æ¥å£ä¼ é€’ï¼ˆä¾èµ–ï¼‰**
  - **æ„é€ æ–¹æ³•ä¼ é€’ï¼ˆä¾èµ–ï¼‰**
  - **setteræ–¹å¼ä¼ é€’ï¼ˆèšåˆï¼‰**

```java
//ä¾èµ–å€’è½¬åŸåˆ™
public class DependenceInversion {
    public static void main(String[] args) {
        persion persion = new persion();
        persion.receve(new Email());
        persion.receve(new Wechat());
    }
}

interface IRecever{
    String getInfo();
}

class Email implements IRecever{

    @Override
    public String getInfo() {
        return "email:helloworld";
    }
}
class Wechat implements IRecever{

    @Override
    public String getInfo() {
        return "Wechat:helloworld";
    }
}



//æ¨¡æ‹Ÿäººæ”¶åˆ°æ¶ˆæ¯
class persion{
    //æ¥å—ç±»å‹ä¸ºæ¥å£
    public void receve(IRecever recever){
        String info = recever.getInfo();
        System.out.println(info);
    }
}
```

## å››ã€é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitutionï¼‰

- **1ã€é‡Œæ°æ›¿æ¢åŸåˆ™(Liskov Substitution Principle)åœ¨1988å¹´ï¼Œç”±éº»çœç†å·¥å­¦é™¢ä¸€ä½å§“é‡Œçš„å¥³å£«æå‡ºï¼›**

- **2ã€å¦‚æœå¯¹æ¯ä¸ªç±»å‹ä¸ºT1çš„å¯¹è±¡o1ï¼Œéƒ½æœ‰ç±»å‹ä¸ºT2çš„å¯¹è±¡o2ï¼Œä½¿å¾—ä»¥T1å®šä¹‰çš„æ‰€æœ‰ç¨‹åºPåœ¨æ‰€æœ‰çš„å¯¹è±¡o1éƒ½ä»£æ¢æˆo2æ—¶ï¼Œç¨‹åºPçš„è¡Œä¸ºæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆç±»å‹T2æ˜¯ç±»å‹T1çš„å­ç±»å‹ã€‚æ¢å¥è¯è¯´ï¼Œæ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡ï¼›**

- **3ã€åœ¨ä½¿ç”¨ç»§æ‰¿æ—¶ï¼Œéµå¾ªé‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œ`åœ¨å­ç±»ä¸­å°½é‡ä¸è¦é‡å†™çˆ¶ç±»çš„æ–¹æ³•`ï¼›**

- **4ã€`ç»§æ‰¿å®é™…ä¸Šè®©ä¸¤ä¸ªç±»è€¦åˆæ€§å¢å¼ºäº†ï¼Œç»™ç¨‹åºå¸¦æ¥ä¾µå…¥æ€§ã€‚åœ¨é€‚å½“çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡èšåˆï¼Œç»„åˆï¼Œä¾èµ–æ¥è§£å†³é—®é¢˜ï¼›`**

- 5ã€**ç»§æ‰¿åŒ…å«è¿™æ ·ä¸€å±‚å«ä¹‰ï¼šçˆ¶ç±»ä¸­å‡¡æ˜¯å·²ç»å®ç°å¥½çš„æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯åœ¨è®¾å®šè§„èŒƒå’Œå¥‘çº¦ï¼Œè™½ç„¶å®ƒä¸å¼ºåˆ¶è¦æ±‚æ‰€æœ‰çš„å­ç±»å¿…é¡»éµå¾ªè¿™äº›å¥‘çº¦ï¼Œä½†æ˜¯å¦‚æœå­ç±»å¯¹è¿™äº›å·²ç»å®ç°çš„æ–¹æ³•ä»»æ„ä¿®æ”¹ï¼Œå°±ä¼šå¯¹æ•´ä¸ªç»§æ‰¿ä½“ç³»é€ æˆç ´åã€‚**

  ```java
  public class LiskovSubstitution {
      public static void main(String[] args) {
          A a = new A();
          System.out.println("2-1=" + a.func1(2, 1));
  
          B b = new B();
          System.out.println("2+1=" + b.func1(2, 1));
          System.out.println("2+1+9=" + b.func2(2, 1));
          System.out.println("Bç±»ä½¿ç”¨Aç±»æ–¹æ³•ï¼š2-1=" + b.func3(2, 1));
      }
  }
  
  class Base {
      //æŠŠåŸºç¡€æ–¹æ³•å’Œæˆå‘˜æŠ½å–æˆåŸºç±»
      public int func1(int num1, int num2) {
          return num1 - num2;
      }
  }
  
  class A extends Base {
  
  //    public int func1(int num1, int num2) {
  //        return num1 - num2;
  //    }
  }
  
  class B extends Base {
  
        // TODO ç±» B `æ— æ„` é‡å†™äº†çˆ¶ç±» A æ–¹æ³•ï¼Œé€ æˆåŸæœ‰æ–¹æ³•å‘ç”Ÿæ”¹å˜ã€‚
  //    @Override
  //    public int func1(int num1, int num2) {
  //        return num1 + num2;
  //    }
  
      @Override
      public int func1(int num1, int num2) {
          return num1 + num2;
      }
  
      public int func2(int num1, int num2) {
          return func1(num1, num2) + 9;
      }
  
      private A a = new A();//ç»„åˆ
  
      //ä½¿ç”¨ A æ–¹æ³•
      public int func3(int num1, int num2) {
          return this.a.func1(num1, num2);
      }
  }
  ```





## äº”ã€å¼€é—­åŸåˆ™ OCPï¼ˆOpen Closed

- **1ã€å¼€é—­åŸåˆ™(Open Closed Principle) æ˜¯ç¼–ç¨‹ä¸­æœ€åŸºç¡€ã€æœ€é‡è¦çš„è®¾è®¡åŸåˆ™ï¼›**
- **2ã€`ä¸€ä¸ªè½¯ä»¶å®ä½“ï¼Œæ¯”å¦‚ç±»ï¼Œæ¨¡å—å’Œå‡½æ•°åº”è¯¥å¯¹æä¾›æ–¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä½¿ç”¨æ–¹ä¿®æ”¹å…³é—­ã€‚ç”¨æŠ½è±¡æ„å»ºæ¡†æ¶ï¼Œç”¨å®ç°æ‰©å±•ç»†èŠ‚ï¼›`**
- **3ã€å½“è½¯ä»¶éœ€è¦å˜åŒ–æ—¶ï¼Œå°½é‡é€šè¿‡æ‰©å±•è½¯ä»¶å®ä½“çš„è¡Œä¸ºæ¥å®ç°å˜åŒ–ï¼Œè€Œä¸æ˜¯é€šè¿‡ä¿®æ”¹å·²æœ‰çš„ä»£ç æ¥å®ç°å˜åŒ–ï¼›**
- **4ã€ç¼–ç¨‹ä¸­éµå¾ªå…¶å®ƒåŸåˆ™ï¼Œä»¥åŠä½¿ç”¨è®¾è®¡æ¨¡å¼çš„ç›®çš„å°±æ˜¯éµå¾ªå¼€é—­åŸåˆ™ã€‚**

```java
//å¼€é—­åŸåˆ™
public class Ocp {
    public static void main(String[] args) {
        Use use = new Use();
        use.drawShape(new Triangle());
        use.drawShape(new Circle());
        use.drawShape(new OtherGraphics());
    }
}


class Use{
    public void drawShape(Shape shape){
        shape.draw();
    }
}

abstract class  Shape{
    public abstract void draw();
}

class Triangle extends Shape{
    @Override
    public void draw() {
        System.out.println("ç»˜åˆ¶ä¸‰è§’å½¢");
    }
}

class  Circle extends  Shape{
    @Override
    public void draw() {
        System.out.println("ç»˜åˆ¶åœ†å½¢");
    }
}
class OtherGraphics extends Shape {

    @Override
    public void draw() {
        System.out.println("å­ç±»å®ç°å…·ä½“åŠŸèƒ½ï¼šä»»ä½•å½¢çŠ¶");
    }
}
```

## å…­ã€è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆDemeterï¼‰

- **1ã€ä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹å…¶ä»–å¯¹è±¡ä¿æŒæœ€å°‘çš„äº†è§£`ï¼ˆæœ€å°‘çŸ¥é“åŸåˆ™ LKPï¼‰`ã€‚**

- **2ã€ç±»ä¸ç±»å…³ç³»è¶Šå¯†åˆ‡ï¼Œè€¦åˆåº¦è¶Šå¤§ã€‚`è¦æ±‚é™ä½ç±»ä¹‹é—´è€¦åˆï¼Œè€Œä¸æ˜¯å®Œå…¨è§£è€¦ã€‚`**

- **3ã€è¿ªç±³ç‰¹æ³•åˆ™(Demeter Principle)ï¼Œå³ä¸€ä¸ªç±»å¯¹è‡ªå·±ä¾èµ–çš„ç±»çŸ¥é“çš„è¶Šå°‘è¶Šå¥½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºè¢«ä¾èµ–çš„ç±»ä¸ç®¡å¤šä¹ˆå¤æ‚ï¼Œéƒ½å°½é‡å°†é€»è¾‘å°è£…åœ¨ç±»çš„å†…éƒ¨ã€‚å¯¹å¤–é™¤äº†æä¾›publicæ–¹æ³•ï¼Œä¸å¯¹å¤–æ³„éœ²ä»»ä½•ä¿¡æ¯ã€‚**

- **4ã€è¿ªç±³ç‰¹æ³•åˆ™æ›´ç®€å•çš„å®šä¹‰ï¼šåªä¸ç›´æ¥çš„æœ‹å‹é€šä¿¡**ã€‚

- **5ã€ç›´æ¥çš„æœ‹å‹ï¼šæ¯ä¸ªå¯¹è±¡éƒ½ä¼šä¸å…¶ä»–å¯¹è±¡æœ‰è€¦åˆå…³ç³»ï¼Œåªè¦ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´æœ‰è€¦åˆå…³ç³»ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´æ˜¯æœ‹å‹å…³ç³»ã€‚è€¦åˆçš„æ–¹å¼å¾ˆå¤šï¼Œä¾èµ–ï¼Œå…³è”ï¼Œç»„åˆï¼Œèšåˆ ç­‰ã€‚å…¶ä¸­ï¼Œæˆ‘ä»¬ç§°å‡ºç°æˆå‘˜å˜é‡ï¼Œæ–¹æ³•å‚æ•°ï¼Œæ–¹æ³•è¿”å›å€¼ä¸­çš„ç±»ä¸ºç›´æ¥çš„æœ‹å‹ï¼Œè€Œå‡ºç°åœ¨å±€éƒ¨å˜é‡ä¸­çš„ç±»ä¸æ˜¯ç›´æ¥çš„æœ‹å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé™Œç”Ÿçš„ç±»æœ€å¥½ä¸è¦ä»¥å±€éƒ¨å˜é‡çš„å½¢å¼å‡ºç°åœ¨ç±»çš„å†…éƒ¨ã€‚**

  ```java
  class A{
  	B b;//å…¨å±€å˜é‡ - ç›´æ¥æœ‹å‹
  	public B m1(){} //æ–¹æ³•è¿”å›å€¼ - ç›´æ¥æœ‹å‹
  	public void m2(B b){}//æ–¹æ³•å…¥å‚ - ç›´æ¥æœ‹å‹
  	public void m3(){
  		B b1 = new B();// å±€éƒ¨å˜é‡ éç›´æ¥æœ‹å‹
  	}
  }
  ```

  ```java
  public class Demeter {
      public static void main(String[] args) {
          SchoolManager schoolManager = new SchoolManager();
          schoolManager.printAllEmployee(new CollegeManager());
      }
  }
  
  //å­¦é™¢å‘˜å·¥ç±»
  class CollegeEmployee {
      private String id;
  
      public String getId() {
          return id;
      }
  
      public void setId(String id) {
          this.id = id;
      }
  }
  
  //ç®¡ç†å­¦é™¢å‘˜å·¥çš„ç®¡ç†ç±»:
  class CollegeManager {
      //è¿”å›å­¦é™¢çš„æ‰€æœ‰å‘˜å·¥ //TODO CollegeEmployee ç›´æ¥æœ‹å‹
      public List<CollegeEmployee> getAllEmployee() {
          List<CollegeEmployee> list = new ArrayList<CollegeEmployee>();
          for (int i = 0; i < 10; i++) { //è¿™é‡Œæˆ‘ä»¬å¢åŠ äº†10 ä¸ªå‘˜å·¥åˆ°list ï¼Œ
              CollegeEmployee emp = new CollegeEmployee();
              emp.setId("å­¦é™¢å‘˜å·¥id " + i);
              list.add(emp);
          }
          return list;
      }
  
      public void printCollegeEmployee() {
          List<CollegeEmployee> list1 = this.getAllEmployee();
          System.out.println("---å­¦é™¢å‘˜å·¥----");
          for (CollegeEmployee e : list1) {
              System.out.println(e.getId());
          }
      }
  }
  
  //å­¦æ ¡æ€»éƒ¨å‘˜å·¥ç±»
  class SchoolEmployee {
      private String id;
  
      public String getId() {
          return id;
      }
  
      public void setId(String id) {
          this.id = id;
      }
  }
  
  //å­¦æ ¡ç®¡ç†ç±»
  //TODO ç›´æ¥æœ‹å‹ Employee CollegeManager
  class SchoolManager {
      //è¿”å›å­¦æ ¡æ€»éƒ¨çš„å‘˜å·¥
      public List<SchoolEmployee> getAllEmployee() {
          List<SchoolEmployee> list = new ArrayList<SchoolEmployee>();
          for (int i = 0; i < 5; i++) { //è¿™é‡Œæˆ‘ä»¬å¢åŠ äº†5ä¸ªå‘˜å·¥åˆ°list
              SchoolEmployee emp = new SchoolEmployee();
              emp.setId("å­¦æ ¡æ€»éƒ¨å‘˜å·¥id= " + i);
              list.add(emp);
          }
          return list;
      }
  
      //è¯¥æ–¹æ³•å®Œæˆè¾“å‡ºå­¦æ ¡æ€»éƒ¨å’Œå­¦é™¢å‘˜å·¥ä¿¡æ¯(id)
      void printAllEmployee(CollegeManager sub) {
          //è·å–åˆ°å­¦é™¢å‘˜å·¥
          //TODO éç›´æ¥æœ‹å‹ CollegeEmployee  åº”è¯¥æå–åˆ°  CollegeManager
  //        List<CollegeEmployee> list1 = sub.getAllEmployee();
  //        System.out.println("---å­¦é™¢å‘˜å·¥----");
  //        for (CollegeEmployee e : list1) {
  //            System.out.println(e.getId());
  //        }
          sub.printCollegeEmployee();//åªæä¾›æ–¹æ³•ï¼Œä¸æŠŠå…·ä½“å®ç°æ”¾åœ¨å…¶ä»–ç±»é‡Œé¢ã€‚
  
          //è·å–åˆ°å­¦æ ¡æ€»éƒ¨å‘˜å·¥
          List<SchoolEmployee> list2 = this.getAllEmployee();
          System.out.println("------å­¦æ ¡æ€»éƒ¨å‘˜å·¥------");
          for (SchoolEmployee e : list2) {
              System.out.println(e.getId());
          }
      }
  }
  ```

  

## ä¸ƒã€åˆæˆå¤ç”¨åŸåˆ™ï¼ˆComposite Reuseï¼‰

**åˆæˆå¤ç”¨åŸåˆ™ å°½é‡ä½¿ç”¨ç»„åˆ/èšåˆçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿ã€‚**

- **1ã€æ‰¾å‡ºåº”ç”¨ä¸­å¯èƒ½éœ€è¦å˜åŒ–ä¹‹å¤„ï¼ŒæŠŠå®ƒä»¬ç‹¬ç«‹å‡ºæ¥ï¼Œä¸è¦å’Œé‚£äº›ä¸éœ€è¦å˜åŒ–çš„ä»£ç æ··åœ¨ä¸€èµ·ã€‚**

- **2ã€é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å®ç°ç¼–ç¨‹ã€‚**

- **3ã€ä¸ºäº†äº¤äº’å¯¹è±¡ä¹‹é—´çš„æ¾è€¦åˆè®¾è®¡è€ŒåŠªåŠ›**ã€‚

- ```java
  public class CompositeReuse {
      public static void main(String[] args) {
          System.out.println("------ä¾èµ–------");
          B b = new B();
          b.Operation1(new A());
  
          System.out.println("------èšåˆ------");
          b.setA(new A());
          b.Operation2();
  
          System.out.println("------ç»„åˆ------");
          b.Operation3();
      }
  }
  
  class A {
      void Operation1() {
          System.out.println("A Operation1");
      }
  
      void Operation2() {
          System.out.println("A Operation2");
      }
  
      void Operation3() {
          System.out.println("A Operation3");
      }
  }
  
  //å¦‚æœåªæ˜¯éœ€è¦ç”¨åˆ° Aç±»çš„æ–¹æ³•ï¼Œå°½é‡ä¸è¦ä½¿ç”¨ç»§æ‰¿ã€‚è€Œæ˜¯ä½¿ç”¨ï¼Œä¾èµ–ï¼Œèšåˆï¼Œç»„åˆçš„æ–¹å¼
  class B {
      void Operation1(A a) {//TODO ä¾èµ–
          a.Operation1();
          a.Operation2();
          a.Operation3();
      }
  
      //==============================================================
      A a;
      public void setA(A a) {
          this.a = a;
      }
  
      void Operation2() {//TODO èšåˆ
          a.Operation1();
          a.Operation2();
          a.Operation3();
      }
  
      //==============================================================
      A a1 = new A();
  
      void Operation3() {//TODO ç»„åˆ
          a1.Operation1();
          a1.Operation2();
          a1.Operation3();
      }
  }
  ```

  æ€»ç»“ä¸€ä¸‹ï¼Œä¾èµ–æ˜¯ä¼ å…¥å‚æ•°ï¼Œèšåˆæ˜¯é€šè¿‡setæ³¨å…¥ï¼Œç»„åˆæ˜¯å†ç±»é‡Œnewä¸€ä¸ªå®ä¾‹ã€‚



# 2ã€UML

**IDEA PlantUMLè¡¨ç¤ºç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»çš„ç¬¦å·**

```java
@startuml

Class1 <|-- ClassA:æ³›åŒ–
Class2 <-- ClassB:å…³è”
Class3 *-- ClassC:ç»„åˆ
Class4 o-- ClassD:èšåˆ
Class5 <|.. ClassE:å®ç°
Class6 <.. ClassF:ä¾èµ–

@enduml
```



![image-20200505172459261](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200505172459261.png)

### 1ã€ä¾èµ–ï¼ˆDependenceï¼‰

**åªè¦æ˜¯åœ¨ç±»ä¸­ç”¨åˆ°äº†å¯¹æ–¹ï¼Œé‚£ä¹ˆä»–ä»¬ä¹‹é—´å°±å­˜åœ¨ä¾èµ–å…³ç³»ã€‚å¦‚æœæ²¡æœ‰å¯¹æ–¹ï¼Œè¿ç¼–ç»éƒ½é€šè¿‡ä¸äº†ã€‚**

- **ç±»ä¸­ç”¨åˆ°äº†å¯¹æ–¹ï¼›**

- **ç±»çš„æˆå‘˜å±æ€§ï¼›**

- **æ–¹æ³•çš„è¿”å›ç±»å‹ï¼›**

- **æ–¹æ³•æ¥æ”¶çš„å‚æ•°ç±»å‹ï¼›**

- **æ–¹æ³•ä¸­ä½¿ç”¨åˆ°**ã€‚

- ![image-20200505174608185](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200505174608185.png)

  ```java
  /**
   * ç±»ä¸­ç”¨åˆ°äº†å¯¹æ–¹ï¼›
   * ç±»çš„æˆå‘˜å±æ€§ï¼›
   * æ–¹æ³•çš„è¿”å›ç±»å‹ï¼›
   * æ–¹æ³•æ¥æ”¶çš„å‚æ•°ç±»å‹ï¼›
   * æ–¹æ³•ä¸­ä½¿ç”¨åˆ°ï¼›
   */
  public class Dependence {
      A a;//TODO ç±»çš„æˆå‘˜å±æ€§
  
      public A save(B b) {//TODO æ–¹æ³•æ¥æ”¶çš„å‚æ•°ç±»å‹
          //TODO æ–¹æ³•çš„è¿”å›ç±»å‹
          System.out.println("");
          A a = new A();//TODO æ–¹æ³•ä¸­ä½¿ç”¨åˆ°
          return a;
      }
  }
  
  class A {}
  
  class B {}
  ```



### 2ã€ç»§æ‰¿ï¼ˆæ³›åŒ– Generalizationï¼‰

![image-20200505174702414](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200505174702414.png)

```java
public class Generalization extends Base {

    @Override
    public void get(Object oId) {

    }

    @Override
    public void put(Object oName) {

    }
}

abstract class Base {
    abstract public void get(Object oId);

    abstract public void put(Object oName);
}
```

### 3ã€å®ç°ï¼ˆRealizationï¼‰

**å®ç°å…³ç³»å®é™…ä¸Šå°±æ˜¯ Aç±» å®ç° Bæ¥å£ï¼Œä¾èµ–å…³ç³»çš„ç‰¹ä¾‹ã€‚**

![image-20200505174744892](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200505174744892.png)

```java
public class Implementation implements Base {
    @Override
    public void init() {
        System.out.println("init");
    }
}

interface Base {
    void init();
}
```

### 4ã€å…³è”ï¼ˆAssociationï¼‰

**ç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»ï¼Œä¾èµ–å…³ç³»çš„ç‰¹ä¾‹ã€‚**

**å…³è”å…·æœ‰å¯¼èˆªæ€§ï¼šå³åŒå‘å…³ç³»æˆ–å•å‘å…³ç³»ã€‚**

![image-20200505174827128](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200505174827128.png)

```java
public class Person {
    private IDCard idCard;
}

class IDCard {
    //private Person person;
}
```

### 5ã€èšåˆï¼ˆAggregationï¼‰

**è¡¨ç¤ºçš„æ˜¯æ•´ä½“å’Œéƒ¨åˆ†çš„å…³ç³»ï¼Œæ•´ä½“ä¸éƒ¨åˆ†å¯ä»¥åˆ†å¼€ï¼Œå…³è”å…³ç³»çš„ç‰¹ä¾‹ã€‚**

**èšåˆå…³ç³»æ˜¯å…³è”å…³ç³»çš„ç‰¹ä¾‹ï¼Œæ‰€ä»¥ä»–å…·æœ‰å…³è”çš„å¯¼èˆªæ€§ä¸å¤šé‡æ€§ã€‚**

![image-20200505174903689](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200505174903689.png)

```java
public class Computer {
    private Mouse mouse;
    private Keyboard keyboard;

    public void setMouse(Mouse mouse) {
        this.mouse = mouse;
    }

    public void setKeyboard(Keyboard keyboard) {
        this.keyboard = keyboard;
    }
}

class Mouse {}

class Keyboard {}
```

### 6ã€ç»„åˆï¼ˆCompositeï¼‰

**æ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³»ï¼Œä½†æ˜¯æ•´ä½“ä¸éƒ¨åˆ†ä¸å¯ä»¥åˆ†å¼€ï¼Œå…³è”å…³ç³»çš„ç‰¹ä¾‹ã€‚**

**çº§è”åˆ é™¤å°±æ˜¯ç»„åˆå…³ç³»ã€‚**

![image-20200505174939312](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200505174939312.png)

```java
public class Computer {
   private CPU cpu = new CPU();
   private SSD ssd = new SSD();
}

class CPU {}

class SSD {}
```



# 3ã€å•ä¾‹æ¨¡å¼

**å•ä¾‹è®¾è®¡æ¨¡å¼ â€”> åˆ›å»ºå‹æ¨¡å¼**

å•ä¾‹æ¨¡å¼ï¼Œæ˜¯ä¸€ç§å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ã€‚åœ¨å®ƒçš„æ ¸å¿ƒç»“æ„ä¸­åªåŒ…å«ä¸€ä¸ªè¢«ç§°ä¸ºå•ä¾‹çš„ç‰¹æ®Šç±»ã€‚
é€šè¿‡å•ä¾‹æ¨¡å¼å¯ä»¥ä¿è¯ç³»ç»Ÿä¸­ï¼Œåº”ç”¨è¯¥æ¨¡å¼çš„ç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚**å³ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚**

**åœ¨javaè¯­è¨€ä¸­ï¼Œå•ä¾‹å¸¦æ¥äº†ä¸¤å¤§å¥½å¤„ï¼š**

ï¼ˆ1ï¼‰å¯¹äºé¢‘ç¹ä½¿ç”¨çš„å¯¹è±¡ï¼ˆæ•°æ®æºã€Sessionå·¥å‚ï¼‰ï¼Œå¯ä»¥çœç•¥åˆ›å»ºå¯¹è±¡æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œè¿™å¯¹äºé‡é‡çº§çš„å¯¹è±¡è€Œè¨€ï¼Œæ˜¯éå¸¸å¯è§‚çš„ä¸€ç¬”ç³»ç»Ÿå¼€é”€ã€‚
ï¼ˆ2ï¼‰ç”±äºnewæ“ä½œçš„æ¬¡æ•°å‡å°‘ï¼Œå› è€Œå¯¹ç³»ç»Ÿå†…å­˜çš„ä½¿ç”¨é¢‘ç‡ä¹Ÿä¼šé™ä½ï¼Œè¿™å°†å‡è½»GCå‹åŠ›ï¼Œç¼©çŸ­GCåœé¡¿æ—¶é—´ã€‚

**å…·ä½“å®ç°**

**éœ€è¦ï¼š**
ï¼ˆ1ï¼‰**å°†æ„é€ æ–¹æ³•ç§æœ‰åŒ–ï¼Œä½¿å…¶ä¸èƒ½åœ¨ç±»çš„å¤–éƒ¨é€šè¿‡newå…³é”®å­—å®ä¾‹åŒ–è¯¥ç±»å¯¹è±¡ã€‚**
ï¼ˆ2ï¼‰**åœ¨è¯¥ç±»å†…éƒ¨äº§ç”Ÿä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œå¹¶ä¸”å°†å…¶å°è£…ä¸º private static ç±»å‹ã€‚**
ï¼ˆ3ï¼‰**å®šä¹‰ä¸€ä¸ªé™æ€æ–¹æ³•è¿”å›è¿™ä¸ªå”¯ä¸€å¯¹è±¡ã€‚**

## å®ç°ä¸€ï¼šé¥¿æ±‰å¼ / é™æ€å¸¸é‡

- **ç«‹å³åŠ è½½å°±æ˜¯ä½¿ç”¨ç±»çš„æ—¶å€™å·²ç»å°†å¯¹è±¡åˆ›å»ºå®Œæ¯•ï¼ˆä¸ç®¡ä»¥åä¼šä¸ä¼šä½¿ç”¨åˆ°è¯¥å®ä¾‹åŒ–å¯¹è±¡ï¼Œå…ˆåˆ›å»ºäº†ï¼‰ã€‚å¸¸è§çš„å®ç°åŠæ³•å°±æ˜¯ç›´æ¥newå®ä¾‹åŒ–ã€‚**

```java
/**
 * æ‡’æ±‰å•ä¾‹
 */
class Singleton{
    //æ„é€ å™¨ç§æœ‰åŒ–
    private Singleton(){
    }
    //ç±»åŠ è½½æ—¶å®ä¾‹åŒ–
    private final static Singleton instance = new Singleton();
    //å¯¹å¤–æä¾›é™æ€æ–¹æ³•
    public static Singleton getInstance(){
        return instance;
    }
}
```

**â€œé¥¿æ±‰æ¨¡å¼â€çš„ä¼˜ç¼ºç‚¹ï¼š**

- ä¼˜ç‚¹ï¼šå®ç°èµ·æ¥ç®€å•ï¼Œ**æ²¡æœ‰å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚**
- ç¼ºç‚¹ï¼šå½“ç±» Singleton è¢«åŠ è½½çš„æ—¶å€™ï¼Œä¼šåˆå§‹åŒ– static çš„ instanceï¼Œé™æ€å˜é‡è¢«åˆ›å»ºå¹¶åˆ†é…å†…å­˜ç©ºé—´ï¼Œä»è¿™ä»¥åï¼Œè¿™ä¸ª static çš„ instance å¯¹è±¡ä¾¿ä¸€ç›´å ç€è¿™æ®µå†…å­˜ï¼Œå¯èƒ½é€ æˆå†…å­˜æµªè´¹ï¼ˆå³ä¾¿ä½ è¿˜æ²¡æœ‰ç”¨åˆ°è¿™ä¸ªå®ä¾‹ï¼‰ã€‚å½“ç±»è¢«å¸è½½æ—¶ï¼Œé™æ€å˜é‡è¢«æ‘§æ¯ï¼Œå¹¶é‡Šæ”¾æ‰€å æœ‰å†…å­˜ï¼Œåœ¨æŸäº›ç‰¹å®šæ¡ä»¶ä¸‹ä¼šè€—è´¹å†…å­˜ã€‚
- å¦‚æœæ–¹æ³•å†…æœ‰å…¶ä»– static æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ­¤ç±»ä¹Ÿ**ä¼š**åŠ è½½åˆå§‹

## å®ç°äºŒï¼šé¥¿æ±‰å¼ / é™æ€ä»£ç å—

```java
//æ‡’æ±‰é™æ€ä»£ç å—
class Singleton1{
    private static Singleton1 instance;
    private Singleton1(){
    }
    static {
         instance = new Singleton1();
    }
    public static Singleton1 getInstance(){
        return instance;
    }
}
```

## å®ç°ä¸‰ï¼šæ‡’æ±‰å¼ / çº¿ç¨‹ä¸å®‰å…¨

- **å»¶è¿ŸåŠ è½½å°±æ˜¯è°ƒç”¨ getInstance() æ–¹æ³•æ—¶å®ä¾‹æ‰è¢«åˆ›å»ºï¼ˆå…ˆä¸æ€¥ç€å®ä¾‹åŒ–å‡ºå¯¹è±¡ï¼Œç­‰è¦ç”¨çš„æ—¶å€™æ‰åˆ›å»ºå‡ºæ¥)ã€‚å¸¸è§çš„å®ç°æ–¹æ³•å°±æ˜¯åœ¨ getInstance() æ–¹æ³•ä¸­è¿›è¡Œnewå®ä¾‹åŒ–ã€‚**

```java
public class LazyLoadingSingletonThreadUnSafe {
    public static void main(String[] args) {
        Singleton singleton1 = Singleton.getInstance();
        Singleton singleton2 = Singleton.getInstance();
        System.out.println(singleton1==singleton2);//true
    }
}
//æ‡’æ±‰å•ä¾‹ çº¿ç¨‹ä¸å®‰å…¨
class Singleton{
    //å°†è‡ªå·±å®ä¾‹åŒ–å¯¹è±¡è®¾ç½®ä¸ºä¸€ä¸ªå±æ€§ï¼Œç”¨static
    private static Singleton instance;
    //æ„é€ æ–¹æ³•ç§æœ‰åŒ–
    private Singleton(){}

    //é™æ€æ–¹æ³•è¿”å›å®ä¾‹
    public static Singleton getInstance(){
        if (instance==null){
            //çº¿ç¨‹åœ¨è¿™é‡Œè¢«é˜»å¡ï¼Œåˆ™å¯¹è±¡æ²¡åˆ«åˆ›å»ºï¼Œä¸å®‰å…¨
            instance = new Singleton();
        }
        return instance;
    }
}
```

**æ‡’æ±‰æ¨¡å¼â€çš„ä¼˜ç¼ºç‚¹ï¼š**

- ä¼˜ç‚¹ï¼šå®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œå½“ç±» Singleton è¢«åŠ è½½çš„æ—¶å€™ï¼Œé™æ€å˜é‡ static çš„ instance æœªè¢«åˆ›å»ºå¹¶åˆ†é…å†…å­˜ç©ºé—´ï¼Œå½“ getInstance() æ–¹æ³•ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨æ—¶ï¼Œåˆå§‹åŒ–instanceå˜é‡ï¼Œå¹¶åˆ†é…å†…å­˜ï¼Œå› æ­¤åœ¨æŸäº›ç‰¹å®šæ¡ä»¶ä¸‹ä¼šèŠ‚çº¦äº†å†…å­˜ã€‚
- ç¼ºç‚¹ï¼š**åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œè¿™ç§å®å®Œç°æ–¹æ³•æ˜¯å…¨é”™è¯¯çš„ï¼Œä¸èƒ½ä¿è¯å•ä¾‹çš„çŠ¶æ€ã€‚**
- å¦‚æœæ–¹æ³•å†…æœ‰å…¶ä»– static æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ­¤ç±»**ä¸ä¼š**åŠ è½½åˆå§‹åŒ–ã€‚

## å®ç°å››ï¼šæ‡’æ±‰å¼ / çº¿ç¨‹å®‰å…¨ Sync

- **é™æ€æ–¹æ³•è¿”å›è¯¥å®ä¾‹ï¼ŒåŠ  `Synchronized` å…³é”®å­—å®ç°åŒæ­¥ã€‚**

```java
class Singleton1{
    //å°†è‡ªå·±å®ä¾‹åŒ–å¯¹è±¡è®¾ç½®ä¸ºä¸€ä¸ªå±æ€§ï¼Œç”¨static
    private static Singleton1 instance;
    //æ„é€ æ–¹æ³•ç§æœ‰åŒ–
    private Singleton1(){}

    //é™æ€æ–¹æ³•è¿”å›å®ä¾‹ï¼Œæ–¹æ³•åŠ synchronized å…³é”®å­—
    public static synchronized Singleton1 getInstance(){
        if (instance==null){
            instance = new Singleton1();
        }
        return instance;
    }
}
```

**çº¿ç¨‹å®‰å…¨çš„â€œæ‡’æ±‰æ¨¡å¼â€ï¼ˆåŠ é”ï¼‰çš„ä¼˜ç¼ºç‚¹ï¼š**

- ä¼˜ç‚¹ï¼šåœ¨å¤šçº¿ç¨‹æƒ…å½¢ä¸‹ï¼Œä¿è¯äº†â€œæ‡’æ±‰æ¨¡å¼â€çš„çº¿ç¨‹å®‰å…¨ã€‚
- ç¼ºç‚¹ï¼šåœ¨å¤šçº¿ç¨‹æƒ…å½¢ä¸‹ï¼Œ**synchronizedæ–¹æ³•é€šå¸¸æ•ˆç‡ä½**ï¼Œæ˜¾ç„¶è¿™ä¸æ˜¯æœ€ä½³çš„å®ç°æ–¹æ¡ˆã€‚
- å¦‚æœæ–¹æ³•å†…æœ‰å…¶ä»–staticæ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ­¤ç±»**ä¸ä¼š**åŠ è½½åˆå§‹åŒ–ã€‚

## å®ç°äº”ï¼šDCLåŒæ£€æŸ¥é”æœºåˆ¶

ï¼ˆDCLï¼šDouble Checked Lockingï¼‰

```java
public class LazyLoadingSingletonDCL {
    public static void main(String[] args) {
        Singleton instance = Singleton.getInstance();
        Singleton instance1 = Singleton.getInstance();
        System.out.println(instance==instance1);
    }
}


class Singleton {
    // å°†è‡ªèº«å®ä¾‹åŒ–å¯¹è±¡è®¾ç½®ä¸ºä¸€ä¸ªå±æ€§ï¼Œå¹¶ç”¨ volatileã€static ä¿®é¥°
    private volatile static Singleton instance;

    //æ„é€ å™¨ç§æœ‰åŒ–
    private Singleton() {
    }

    // é™æ€æ–¹æ³•è¿”å›è¯¥å®ä¾‹
    public static Singleton getInstance() {
        // ç¬¬ä¸€æ¬¡æ£€æŸ¥instanceæ˜¯å¦è¢«å®ä¾‹åŒ–å‡ºæ¥
        if (instance == null) {
            synchronized (Singleton.class) {
                // æŸä¸ªçº¿ç¨‹å–å¾—äº†ç±»é”ï¼Œå®ä¾‹åŒ–å¯¹è±¡å‰ç¬¬äºŒæ¬¡æ£€æŸ¥ instance æ˜¯å¦å·²ç»è¢«å®ä¾‹åŒ–
                if (instance == null) {
                    instance = new Singleton();
                }
            }
        }
        return instance;
    }
}
```

**æ–¹æ³•äº”ç®—æ˜¯å•ä¾‹æ¨¡å¼çš„æœ€ä½³å®ç°æ–¹å¼ã€‚å†…å­˜å ç”¨ç‡é«˜ï¼Œæ•ˆç‡é«˜ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œå¤šçº¿ç¨‹æ“ä½œåŸå­æ€§ã€‚**

- å¦‚æœæ–¹æ³•å†…æœ‰å…¶ä»– static æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ­¤ç±»**ä¸ä¼š**åŠ è½½åˆå§‹åŒ–ã€‚

## å®ç°å…­ï¼šé™æ€å†…éƒ¨ç±»

```java
class Singleton{
    private Singleton(){}

    public static Singleton getInstance(){
        return SingleHolder.INSTANCE;
    }
    //é™æ€çš„å†…éƒ¨ç±»
    private static class SingleHolder{
        //åŠ è½½ Singleton ç±»æ—¶å¹¶ä¸ä¼šåŠ è½½å†…éƒ¨ç±»
        private static final Singleton INSTANCE = new Singleton();
    }
}
```

ç¬¬ä¸€æ¬¡åŠ è½½ Singleton ç±»æ—¶å¹¶ä¸ä¼šåŠ è½½å†…éƒ¨ç±»åˆå§‹åŒ– Instanceï¼Œåªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨ getInstance æ–¹æ³•æ—¶è™šæ‹ŸæœºåŠ è½½ SingletonHolder å¹¶åˆå§‹åŒ– Instance ï¼Œè¿™æ ·ä¸ä»…èƒ½ç¡®ä¿çº¿ç¨‹å®‰å…¨ä¹Ÿèƒ½ä¿è¯ Singletonç±»çš„å”¯ä¸€æ€§ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼ã€‚

## JDK ä¸­å•ä¾‹çš„åº”ç”¨ Runtime ç±»

```java
public class Runtime {
    private static Runtime currentRuntime = new Runtime();

    public static Runtime getRuntime() {
        return currentRuntime;
    }
	//TODO ç§æœ‰åŒ–æ„é€ å™¨
    private Runtime() {}
```

# 4ã€å·¥å‚æ¨¡å¼

**å·¥å‚è®¾è®¡æ¨¡å¼ â€”> åˆ›å»ºå‹æ¨¡å¼**

**å¯¹è±¡éƒ½éœ€è¦åˆ›å»ºï¼Œå¦‚æœåˆ›å»ºçš„æ—¶å€™ç›´æ¥ new è¯¥å¯¹è±¡ï¼Œå°±ä¼šå¯¹è¯¥å¯¹è±¡ä¸¥é‡è€¦åˆ**

å‡å¦‚æˆ‘ä»¬è¦æ›´æ¢å¯¹è±¡ï¼Œæ‰€æœ‰ new å¯¹è±¡çš„åœ°æ–¹éƒ½éœ€è¦ä¿®æ”¹ä¸€éï¼Œæ˜¾ç„¶è¿èƒŒäº†è½¯ä»¶è®¾è®¡çš„å¼€é—­åŸåˆ™ï¼ˆOCPï¼‰ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨å·¥å‚æ¥ç”Ÿäº§å¯¹è±¡ï¼Œæˆ‘ä»¬å°±åªå’Œå·¥å‚æ‰“äº¤é“å°±å¯ä»¥äº†ï¼Œå½»åº•å’Œå¯¹è±¡è§£è€¦ï¼Œå¦‚æœè¦æ›´æ¢å¯¹è±¡ï¼Œç›´æ¥åœ¨å·¥å‚é‡Œæ›´æ¢è¯¥å¯¹è±¡å³å¯ï¼Œè¾¾åˆ°äº†ä¸å¯¹è±¡è§£è€¦çš„ç›®çš„ï¼›

**`å·¥å‚æ¨¡å¼æœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯ï¼šè§£è€¦`**

**ä¸‰ç§å·¥å‚è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨ï¼š**

- **1ã€ç®€å•å·¥å‚**
- **2ã€å·¥å‚æ–¹æ³•**
- **3ã€æŠ½è±¡å·¥å‚**



## 1ã€ç®€å•å·¥å‚è®¾è®¡æ¨¡å¼

**å®šä¹‰ï¼šä¸€ä¸ªå·¥å‚æ–¹æ³•ï¼Œä¾æ®ä¼ å…¥çš„å‚æ•°ï¼Œç”Ÿæˆå¯¹åº”çš„äº§å“å¯¹è±¡ï¼›**

**è§’è‰²ï¼š**

- **1ã€æŠ½è±¡äº§å“ç±»**
- **2ã€å…·ä½“äº§å“ç±»**
- **3ã€å…·ä½“å·¥å‚ ç±»**

**ä½¿ç”¨è¯´æ˜ï¼š**

- å…ˆå°†äº§å“ç±»æŠ½è±¡å‡ºæ¥ï¼Œæ¯”å¦‚ï¼Œè‹¹æœå’Œæ¢¨éƒ½å±äºæ°´æœã€‚
- æŠ½è±¡å‡ºæ¥ä¸€ä¸ªæ°´æœç±» Fruitï¼Œè‹¹æœå’Œæ¢¨å°±æ˜¯å…·ä½“çš„äº§å“ç±»ã€‚
- ç„¶ååˆ›å»ºä¸€ä¸ªæ°´æœå·¥å‚ï¼Œåˆ†åˆ«ç”¨æ¥åˆ›å»ºè‹¹æœå’Œæ¢¨ã€‚

![image-20200506135112303](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200506135112303.png)

æŠ½è±¡æ°´æœç±»

```java

public abstract class Fruit {

    public abstract void getName();
}
```

å…·ä½“ç±» è‹¹æœ

```java
public class Apple extends Fruit {
    @Override
    public void getName() {
        System.out.println("apple");
    }
}
```

å…·ä½“ç±» æ¢¨

```java
public class Pear extends Fruit {
    @Override
    public void getName() {
        System.out.println("pear");
    }
}
```

æ°´æœå·¥å‚

```java
public class FruitFactory {
    public Fruit creatFruit(String type) {
        System.out.println("======FruitFactory creatFruit====");
        if (type.equals("apple")) {//ç”Ÿäº§è‹¹æœ
            return new Apple();
        } else if (type.equals("pear")) {//ç”Ÿäº§æ¢¨
            return new Pear();
        }
        return null;
    }
}
```

ç®€å•å·¥å‚çš„ä½¿ç”¨

```java
public class simpleFactory {
    public static void main(String[] args) {
        FruitFactory fruitFactory = new FruitFactory();
        Fruit apple = fruitFactory.creatFruit("apple");//è·å¾—è‹¹æœ
        apple.getName();
        Fruit pear = fruitFactory.creatFruit("pear");//è·å¾—æ¢¨
        pear.getName();
    }
}
```

**ä¸€ä¸ªç®€å•å·¥å‚è®¾è®¡æ¨¡å¼å°±å®Œæˆäº†ï¼Œä½†æ˜¯æœ‰é—®é¢˜ã€‚å¦‚æœæˆ‘æƒ³åƒé¦™è•‰ï¼Œæƒ³åƒæ©˜å­ã€‚è¿™ç§æ–¹å¼ï¼Œæ¯å½“æˆ‘æƒ³æ·»åŠ ä¸€ç§æ°´æœï¼Œå°±å¿…ç„¶è¦ä¿®æ”¹å·¥å‚ç±»ï¼Œè¿™æ˜¾ç„¶ä¹Ÿè¿åäº†å¼€é—­åŸåˆ™ï¼Œäº¦ä¸å¯å–ï¼›æ‰€ä»¥ç®€å•å·¥å‚åªé€‚åˆäºäº§å“å¯¹è±¡è¾ƒå°‘ï¼Œä¸”äº§å“å›ºå®šçš„éœ€æ±‚ï¼Œå¯¹äºäº§å“å˜åŒ–æ— å¸¸çš„éœ€æ±‚æ¥è¯´ä¸åˆé€‚ï¼›**

## 2ã€å·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼

**å®šä¹‰ï¼šå°†å·¥å‚æå–æˆä¸€ä¸ªæ¥å£æˆ–æŠ½è±¡ç±»ï¼Œå…·ä½“ç”Ÿäº§ä»€ä¹ˆäº§å“ç”±å­ç±»å†³å®šã€‚ï¼ˆ`å…·ä½“å·¥å‚ç”Ÿäº§å…·ä½“ç±»`ï¼‰**

**è§’è‰²ï¼š**

- **1ã€æŠ½è±¡äº§å“ç±»**
- **2ã€å…·ä½“äº§å“ç±»**
- **3ã€æŠ½è±¡å·¥å‚ç±»**
- **4ã€å…·ä½“å·¥å‚ç±»**

![image-20200506141253660](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200506141253660.png)

**å’Œä¸Šä¾‹ä¸­ä¸€æ ·ï¼Œäº§å“ç±»æŠ½è±¡å‡ºæ¥ï¼Œæ­¤ä¾‹æŠŠå·¥å‚ç±»ä¹ŸæŠ½è±¡å‡ºæ¥ï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼å°†å¯¹è±¡çš„å®ä¾‹åŒ–æ¨è¿Ÿåˆ°å­ç±»ã€‚**

------

**æ°´æœæŠ½è±¡ç±» è‹¹æœç±»å’Œæ¢¨ç±» ä»£ç å’Œä¸Šä¾‹ä¸€æ ·**



**æŠ½è±¡å·¥å‚ç±»**

```java
public abstract class FruitFactory {
    public abstract Fruit creatFruit();
}
```

**å…·ä½“å·¥å‚ è‹¹æœå·¥å‚**

```java
public class AppleFactory extends FruitFactory {
    @Override
    public Fruit creatFruit() {
        return new Apple();
    }
}
```

**å…·ä½“å·¥å‚ æ¢¨å·¥å‚**

```java
public class PearFactory extends FruitFactory {
    @Override
    public Fruit creatFruit() {
        return new Pear();
    }
}
```

 **å·¥å‚æ–¹æ³•ä½¿ç”¨**

```java
public class factoryMethod {
    public static void main(String[] args) {
        AppleFactory appleFactory = new AppleFactory();//è‹¹æœå·¥å‚ç”Ÿäº§è‹¹æœ
        Fruit apple = appleFactory.creatFruit();
        apple.getName();
        PearFactory pearFactory = new PearFactory();//æ¢¨å·¥å‚ç”Ÿäº§æ¢¨
        Fruit pear = pearFactory.creatFruit();
        pear.getName();
    }
}
```

**ä»¥ä¸Šè¿™ç§æ–¹å¼ï¼Œè™½ç„¶è§£è€¦äº†ï¼Œä¹Ÿéµå¾ªäº†å¼€é—­åŸåˆ™ï¼Œä½†æ˜¯é—®é¢˜æ ¹æœ¬è¿˜æ˜¯æ²¡æœ‰è§£å†³å•Šï¼Œæ¢æ±¤æ²¡æ¢è¯ï¼Œå¦‚æœæˆ‘éœ€è¦çš„äº§å“å¾ˆå¤šçš„è¯ï¼Œéœ€è¦åˆ›å»ºéå¸¸å¤šçš„å·¥å‚ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼çš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼›**

##  3ã€æŠ½è±¡å·¥å‚è®¾è®¡æ¨¡å¼

**å®šä¹‰ï¼šä¸ºåˆ›å»ºä¸€ç»„ç›¸å…³æˆ–è€…æ˜¯ç›¸äº’ä¾èµ–çš„å¯¹è±¡æä¾›çš„ä¸€ä¸ªæ¥å£ï¼Œè€Œä¸éœ€è¦æŒ‡å®šå®ƒä»¬çš„å…·ä½“ç±»ã€‚**

**è§’è‰²ï¼š**

- **1ã€æŠ½è±¡äº§å“ç±»**
- **2ã€å…·ä½“äº§å“ç±»**
- **3ã€æŠ½è±¡å·¥å‚ç±»**
- **4ã€å…·ä½“å·¥å‚ç±»**

**æŠ½è±¡å·¥å‚å’Œå·¥å‚æ–¹æ³•çš„æ¨¡å¼åŸºæœ¬ä¸€æ ·ï¼ŒåŒºåˆ«åœ¨äºï¼Œå·¥å‚æ–¹æ³•æ˜¯ç”Ÿäº§ä¸€ä¸ªå…·ä½“çš„äº§å“ï¼Œè€ŒæŠ½è±¡å·¥å‚å¯ä»¥ç”¨æ¥ç”Ÿäº§ä¸€ç»„ç›¸åŒï¼Œæœ‰ç›¸å¯¹å…³ç³»çš„äº§å“ï¼›é‡ç‚¹åœ¨äºä¸€ç»„ï¼Œä¸€æ‰¹ï¼Œä¸€ç³»åˆ—ã€‚**

------

**ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚ç”Ÿäº§ Iphone æ‰‹æœºï¼ŒIphone æ‰‹æœºæœ‰å¾ˆå¤šç³»åˆ—ï¼ŒIphone8ã€IphoneXSç­‰ï¼›å‡å¦‚Apple8ç”Ÿäº§éœ€è¦ CPU A11çš„å¤„ç†å™¨ï¼ŒLCDå±å¹•ï¼Œè€Œ AppleXs éœ€è¦ CPU A12 çš„å¤„ç†å™¨å’Œ OLED å±å¹•ï¼›ç”¨æŠ½è±¡å·¥å‚æ¥å®ç°ï¼š**

![image-20200506141638638](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200506141638638.png)

**CPU æŠ½è±¡ç±»å’Œå®ç°ç±»**

```java
public abstract class Cpu {
    public abstract void run();
}

class A11 extends Cpu{
    @Override
    public void run() {
        System.out.println("A11");
    }
}

class A12 extends  Cpu{
    @Override
    public void run() {
        System.out.println("A12");
    }
}
```

**å±å¹• æŠ½è±¡ç±»å’Œå®ç°ç±»**

```java
public abstract class Screen {
    public abstract void isScreen();
}

class LCD extends Screen{
    @Override
    public void isScreen() {
        System.out.println("LCD");
    }
}

class OLCD extends Screen{
    @Override
    public void isScreen() {
        System.out.println("OLCD");
    }
}
```

**æ‰‹æœºå·¥å‚æ¥å£**

```java
public interface PhoneFactory {
    Cpu getCpu();//è·å¾—cpu
    Screen getScreen();//è·å¾—å±å¹•

}
```

**æ‰‹æœºå·¥å‚å®ç°**

```java
public class Iphone8Factory implements PhoneFactory {
    @Override
    public Cpu getCpu() {
        return new A11();
    }

    @Override
    public Screen getScreen() {
        return new OLCD();
    }
}

public class IPhoneXSFactory implements  PhoneFactory {
    @Override
    public Cpu getCpu() {
        return new A12();
    }

    @Override
    public Screen getScreen() {
        return new LCD();
    }
}
```

**æŠ½è±¡å·¥å‚ä½¿ç”¨**

```java
public class abstractFactory {
    public static void main(String[] args) {
        Iphone8Factory iphone8Factory = new Iphone8Factory();
        IPhoneXSFactory iPhoneXSFactory = new IPhoneXSFactory();
        System.out.println("========iphone8Factory==========");
        Cpu cpuA11 = iphone8Factory.getCpu();
        Screen screen = iphone8Factory.getScreen();
        cpuA11.run();
        screen.isScreen();
        System.out.println("========iPhoneXSFactory==========");
        Cpu cpuA12 = iPhoneXSFactory.getCpu();
        Screen screen1 = iPhoneXSFactory.getScreen();
        cpuA12.run();
        screen1.isScreen();
    }
}
```

**ä»¥ä¸Šä¾‹å­å¯ä»¥çœ‹å‡ºï¼ŒæŠ½è±¡å·¥å‚å¯ä»¥è§£å†³ä¸€ç³»åˆ—çš„äº§å“ç”Ÿäº§çš„éœ€æ±‚ï¼Œå¯¹äºå¤§æ‰¹é‡ï¼Œå¤šç³»åˆ—çš„äº§å“ï¼Œç”¨æŠ½è±¡å·¥å‚å¯ä»¥æ›´å¥½çš„ç®¡ç†å’Œæ‰©å±•ï¼›**

------

## ä¸‰ç§å·¥å‚æ–¹å¼æ€»ç»“

- 1ã€å¯¹äºç®€å•å·¥å‚å’Œå·¥å‚æ–¹æ³•æ¥è¯´ï¼Œä¸¤è€…çš„ä½¿ç”¨æ–¹å¼å®é™…ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœå¯¹äºäº§å“çš„åˆ†ç±»å’Œåç§°æ˜¯ç¡®å®šçš„ï¼Œæ•°é‡æ˜¯ç›¸å¯¹å›ºå®šçš„ï¼Œæ¨èä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼ï¼›
- 2ã€æŠ½è±¡å·¥å‚ç”¨æ¥è§£å†³ç›¸å¯¹å¤æ‚çš„é—®é¢˜ï¼Œé€‚ç”¨äºä¸€ç³»åˆ—ã€å¤§æ‰¹é‡çš„å¯¹è±¡ç”Ÿäº§ï¼›

## JDK ä¸­å·¥å‚è®¾è®¡æ¨¡å¼çš„åº”ç”¨ Calendar ç±»

```java
Calendar.getInstance();

public static Calendar getInstance(){
        return createCalendar(TimeZone.getDefault(), 					                              Locale.getDefault(Locale.Category.FORMAT));
}

public static Locale getDefault(Locale.Category category) {
    // do not synchronize this method - see 4071298
    switch (category) {
        case DISPLAY:
            if (defaultDisplayLocale == null) {
                synchronized(Locale.class) {
                    if (defaultDisplayLocale == null) {
                        defaultDisplayLocale = initDefault(category);
                    }
                }
            }
            return defaultDisplayLocale;
        case FORMAT:
            if (defaultFormatLocale == null) {
                synchronized(Locale.class) {
                    if (defaultFormatLocale == null) {
                        defaultFormatLocale = initDefault(category);
                    }
                }
            }
            return defaultFormatLocale;
        default:
            assert false: "Unknown Category";
    }
    return getDefault();
}


private static Calendar createCalendar(TimeZone zone,Locale aLocale){
    CalendarProvider provider =
        LocaleProviderAdapter.getAdapter(CalendarProvider.class, aLocale)
        .getCalendarProvider();
    if (provider != null) {
        try {
            return provider.getInstance(zone, aLocale);
        } catch (IllegalArgumentException iae) {
            // fall back to the default instantiation
        }
    }

    Calendar cal = null;

    if (aLocale.hasExtensions()) {
        String caltype = aLocale.getUnicodeLocaleType("ca");
        if (caltype != null) {
            switch (caltype) {
                case "buddhist":
                    cal = new BuddhistCalendar(zone, aLocale);
                    break;
                case "japanese":
                    cal = new JapaneseImperialCalendar(zone, aLocale);
                    break;
                case "gregory":
                    cal = new GregorianCalendar(zone, aLocale);
                    break;
            }
        }
    }
    if (cal == null) {
        // If no known calendar type is explicitly specified,
        // perform the traditional way to create a Calendar:
        // create a BuddhistCalendar for th_TH locale,
        // a JapaneseImperialCalendar for ja_JP_JP locale, or
        // a GregorianCalendar for any other locales.
        // NOTE: The language, country and variant strings are interned.
        if (aLocale.getLanguage() == "th" && aLocale.getCountry() == "TH") {
            cal = new BuddhistCalendar(zone, aLocale);
        } else if (aLocale.getVariant() == "JP" && aLocale.getLanguage() == "ja"
                   && aLocale.getCountry() == "JP") {
            cal = new JapaneseImperialCalendar(zone, aLocale);
        } else {
            cal = new GregorianCalendar(zone, aLocale);
        }
    }
    return cal;
}
```

# 5ã€é€‚é…å™¨æ¨¡å¼

**é€‚é…å™¨è®¾è®¡æ¨¡å¼â€”> ç»“æ„å‹æ¨¡å¼**

**åŸºæœ¬ä»‹ç»**

- **é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰å°†æŸä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·ç«¯æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£è¡¨ç¤ºï¼Œä¸»çš„ç›®çš„æ˜¯å…¼å®¹æ€§ï¼Œè®©åŸæœ¬å› æ¥å£ä¸åŒ¹é…ä¸èƒ½ä¸€èµ·å·¥ä½œçš„ä¸¤ä¸ªç±»å¯ä»¥ååŒå·¥ä½œã€‚å…¶åˆ«åä¸ºåŒ…è£…å™¨(Wrapper)**
- **ä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼šç±»é€‚é…å™¨æ¨¡å¼ã€å¯¹è±¡é€‚é…å™¨æ¨¡å¼ã€æ¥å£é€‚é…å™¨æ¨¡å¼**



**å·¥ä½œåŸç†**

- **é€‚é…å™¨æ¨¡å¼ï¼šå°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå¦ä¸€ç§æ¥å£ï¼Œè®©åŸæœ¬æ¥å£ä¸å…¼å®¹çš„ç±»å¯ä»¥å…¼å®¹ï¼›**
- **ä»ç”¨æˆ·çš„è§’åº¦çœ‹ä¸åˆ°è¢«é€‚é…è€…ï¼Œæ˜¯è§£è€¦çš„ï¼›**
- **ç”¨æˆ·è°ƒç”¨é€‚é…å™¨è½¬åŒ–å‡ºæ¥çš„ç›®æ ‡æ¥å£æ–¹æ³•ï¼Œé€‚é…å™¨å†è°ƒç”¨è¢«é€‚é…è€…çš„ç›¸å…³æ¥å£æ–¹æ³•ï¼›**
- **ç”¨æˆ·æ”¶åˆ°åé¦ˆç»“æœï¼Œæ„Ÿè§‰åªæ˜¯å’Œç›®æ ‡æ¥å£äº¤äº’ï¼Œå¦‚å›¾**

![image-20200509153437305](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200509153437305.png)

### 1ã€ç±»é€‚é…å™¨æ¨¡å¼

- **Java æ˜¯å•ç»§æ‰¿æœºåˆ¶ï¼Œæ‰€ä»¥ç±»é€‚é…å™¨éœ€è¦ç»§æ‰¿ Src ç±»è¿™ä¸€ç‚¹ç®—æ˜¯ä¸€ä¸ªç¼ºç‚¹ï¼Œå› ä¸ºè¿™è¦æ±‚ Dst å¿…é¡»æ˜¯æ¥å£ï¼Œæœ‰ä¸€å®šå±€é™æ€§;**
- **Src ç±»çš„æ–¹æ³•åœ¨ Adapter ä¸­éƒ½ä¼šæš´éœ²å‡ºæ¥ï¼Œä¹Ÿå¢åŠ äº†ä½¿ç”¨çš„æˆæœ¬ã€‚**
- **ç”±äºå…¶ç»§æ‰¿äº† Srcç±»ï¼Œæ‰€ä»¥å®ƒå¯ä»¥æ ¹æ®éœ€æ±‚é‡å†™ Srcç±»çš„æ–¹æ³•ï¼Œä½¿å¾—Adapterçš„çµæ´»æ€§å¢å¼ºäº†ã€‚**

**ä»¥ç”Ÿæ´»ä¸­å……ç”µå™¨çš„ä¾‹å­ä»‹ç»é€‚é…å™¨**

- **å……ç”µå™¨æœ¬èº«ç›¸å½“äº Adapter**
- **220Väº¤æµç”µç›¸å½“äº Srcï¼ˆå³è¢«é€‚é…è€…ï¼‰ï¼Œ**
- **5Vç›´æµç”µç›¸å½“äº Dstï¼ˆå³ç›®æ ‡ï¼‰ã€‚**

![image-20200509153504609](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200509153504609.png)

è¢«é€‚é…è€… Src Class

```java
public class Voltage220V {
    public int output220V(){
        int voltage = 220;
        System.out.println("è¾“å‡º220V");
        return  voltage;
    }
}
```

é€‚é…å™¨æ¥å£ Dst Class

```java
public interface IVoltage5V {
    public int output5V();
}
```

 é€‚é…å™¨ Adapter Class

```java
public class VoltageAdapter extends Voltage220V implements IVoltage5V {
    @Override
    public int output5V() {
        System.out.println("é€‚é…å™¨é€‚é…ç”µå‹");
        int srcV = output220V();
        int dscV = srcV/44;
        System.out.println("é€‚é…åçš„ç”µå‹ä¸º"+dscV+"V");
        return dscV;
    }
}
```

Phone Class

```java
public class Phone {
    public void charging(IVoltage5V iVoltage5V) {
        int i = iVoltage5V.output5V();
        if (i == 5) {
            System.out.println("5Vç”µå‹æ­£åœ¨å……ç”µ");
        } else if (i > 5) {
            System.out.println("ç”µå‹å¤§äº5Vï¼Œæ— æ³•å……ç”µ");
        }
    }
}
```

Client Class

```java
public class Client {
    public static void main(String[] args) {
        Phone phone = new Phone();
        phone.charging(new VoltageAdapter());
    }
}
```

### 2ã€å¯¹è±¡é€‚é…å™¨æ¨¡å¼

- **åŸºæœ¬æ€è·¯å’Œç±»çš„é€‚é…å™¨æ¨¡å¼ç›¸åŒï¼Œå…¶å®ç®—æ˜¯åŒä¸€ç§æ€æƒ³ï¼Œåªæ˜¯å°† Adapter ç±»ä½œä¿®æ”¹ï¼Œä¸æ˜¯ç»§æ‰¿ Srcç±»ï¼Œ è€Œæ˜¯æŒæœ‰ Srcç±»çš„å®ä¾‹ï¼Œä»¥è§£å†³å…¼å®¹æ€§çš„é—®é¢˜ã€‚å³ï¼šæŒæœ‰ Srcç±»ï¼Œå®ç° Dstç±»æ¥å£ï¼Œå®Œæˆ Src â€”> Dst çš„é€‚é…ï¼›**
- **æ ¹æ®åˆæˆå¤ç”¨åŸåˆ™ï¼Œä½¿ç”¨èšåˆæ›¿ä»£ç»§æ‰¿ï¼Œæ‰€ä»¥å®ƒè§£å†³äº†ç±»é€‚é…å™¨å¿…é¡»ç»§æ‰¿ Srcçš„å±€é™æ€§é—®é¢˜ï¼Œä¹Ÿä¸å†è¦æ±‚ Dstå¿…é¡»æ˜¯æ¥å£ã€‚ä½¿ç”¨æˆæœ¬æ›´ä½ï¼Œæ›´çµæ´»ã€‚**
- **æ ¹æ® `åˆæˆå¤ç”¨åŸåˆ™`ï¼Œåœ¨ç³»ç»Ÿä¸­å°½é‡ä½¿ç”¨å…³è”å…³ç³»æ¥æ›¿ä»£ç»§æ‰¿å…³ç³»ï¼Œå› æ­¤å¤§éƒ¨åˆ†ç»“æ„å‹æ¨¡å¼éƒ½æ˜¯å¯¹è±¡ç»“æ„å‹æ¨¡å¼ã€‚å¯¹è±¡é€‚é…å™¨æ¨¡å¼æ˜¯é€‚é…å™¨æ¨¡å¼å¸¸ç”¨çš„ä¸€ç§ï¼›**

![image-20200509155446332](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200509155446332.png)

ğŸ‘‰ é€‚é…å™¨ Adapter Object

**`ç”±ç»§æ‰¿å˜æˆäº†èšåˆ`**

```java
public class VoltageAdapter implements IVoltage5V {
    //ä¸ä½¿ç”¨ç»§æ‰¿ ä½¿ç”¨èšåˆ
    private Voltage220V voltage220V;

    public VoltageAdapter(Voltage220V voltage220V) {
        this.voltage220V = voltage220V;
    }

    @Override
    public int output5V() {
        int dscV = 0;
        if (voltage220V != null) {
            System.out.println("é€‚é…å™¨é€‚é…ç”µå‹");
            int srcV = voltage220V.output220V();
            dscV = srcV / 44;
            System.out.println("é€‚é…åçš„ç”µå‹ä¸º" + dscV + "V");
            return dscV;
        }
        return dscV;
    }
}

```

### 3ã€æ¥å£é€‚é…å™¨æ¨¡å¼

- **æ ¸å¿ƒæ€è·¯ï¼šå½“ä¸éœ€è¦å…¨éƒ¨å®ç°æ¥å£æä¾›çš„æ–¹æ³•æ—¶ï¼Œå¯å…ˆè®¾è®¡ä¸€ä¸ªæŠ½è±¡ç±»å®ç°æ¥å£ï¼Œå¹¶ä¸ºè¯¥æ¥å£ä¸­æ¯ä¸ªæ–¹æ³•æä¾›ä¸€ä¸ªé»˜è®¤å®ç°(ç©ºæ–¹æ³•)ï¼Œé‚£ä¹ˆè¯¥æŠ½è±¡ç±»çš„å­ç±»å¯æœ‰é€‰æ‹©åœ°è¦†ç›–çˆ¶ç±»çš„æŸäº›æ–¹æ³•æ¥å®ç°éœ€æ±‚ã€‚**
- **é€‚ç”¨äºä¸€ä¸ªæ¥å£ä¸æƒ³ä½¿ç”¨å…¶æ‰€æœ‰çš„æ–¹æ³•çš„æƒ…å†µã€‚**

é€‚é…å™¨æ¥å£

```java
public interface Interface {
	public void m1();
	public void m2();
	public void m3();
	public void m4();
    public void m5();
}
```

æŠ½è±¡ç±»å®ç°æ¥å£ ç©ºæ–¹æ³•

```java
public class AbsAdapter implements Interface {
    @Override
    public void m1() {
    }
    @Override
    public void m2() {
    }
    @Override
    public void m3() {
    }
    @Override
    public void m4() {
    }
    @Override
    public void m5() {
    }
}
```

Client

```java
public class Client {
    public static void main(String[] args) {
        AbsAdapter absAdapter = new AbsAdapter(){
            @Override
            public void m1() {
                System.out.println("m1");
            }

            @Override
            public void m2() {
                System.out.println("m2");
            }
        };
        absAdapter.m1();
        absAdapter.m2();
        absAdapter.m3();
    }
}

```

**é€‚é…å™¨æ¨¡å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚**

- ä¸‰ç§å‘½åæ–¹å¼ï¼Œæ˜¯æ ¹æ® Src æ˜¯ä»¥æ€æ ·çš„å½¢å¼ç»™åˆ° Adapter (åœ¨Adapteré‡Œçš„å½¢å¼) æ¥å‘½åçš„ã€‚
  - **ç±»é€‚é…å™¨ï¼šä»¥ç±»ç»™åˆ°ï¼Œåœ¨Adapteré‡Œï¼Œå°±æ˜¯å°† Src å½“åšç±»ï¼Œç»§æ‰¿ï¼›**
  - **å¯¹è±¡é€‚é…å™¨ï¼šä»¥å¯¹è±¡ç»™åˆ°ï¼Œåœ¨Adapteré‡Œï¼Œå°† Src ä½œä¸ºä¸€ä¸ªå¯¹è±¡ï¼ŒæŒæœ‰**
  - **æ¥å£é€‚é…å™¨ï¼šä»¥æ¥å£ç»™åˆ°ï¼Œåœ¨Adapteré‡Œï¼Œå°† Src ä½œä¸ºä¸€ä¸ªæ¥å£ï¼Œå®ç°**
- **Adapter æ¨¡å¼æœ€å¤§çš„ä½œç”¨è¿˜æ˜¯å°†åŸæœ¬ä¸å…¼å®¹çš„æ¥å£èåˆåœ¨ä¸€èµ·å·¥ä½œã€‚**

**é€‚é…å™¨æ¨¡å¼åœ¨SpringMVCæ¡†æ¶åº”ç”¨**

- **SpringMvc ä¸­çš„ HandlerAdapterï¼Œå°±ä½¿ç”¨äº†é€‚é…å™¨æ¨¡å¼ï¼›**
- **ä½¿ç”¨ HandlerAdapter çš„åŸå› åˆ†æï¼šå¯ä»¥çœ‹åˆ°å¤„ç†å™¨çš„ç±»å‹ä¸åŒï¼Œæœ‰å¤šé‡å®ç°æ–¹å¼ï¼Œé‚£ä¹ˆè°ƒç”¨æ–¹å¼å°±ä¸æ˜¯ç¡®å®šçš„ï¼Œå¦‚æœéœ€è¦ç›´æ¥è°ƒç”¨ Controller æ–¹æ³•ï¼Œéœ€è¦è°ƒç”¨çš„æ—¶å€™å°±å¾—ä¸æ–­æ˜¯ä½¿ç”¨ if/else æ¥è¿›è¡Œåˆ¤æ–­æ˜¯å“ªä¸€ç§å­ç±»ç„¶åæ‰§è¡Œã€‚é‚£ä¹ˆå¦‚æœåé¢è¦æ‰©å±•Controllerï¼Œå°±å¾—ä¿®æ”¹åŸæ¥çš„ä»£ç ï¼Œè¿™æ ·è¿èƒŒäº†OCPåŸåˆ™ã€‚**

# 6ã€è£…é¥°è€…æ¨¡å¼

- **è£…é¥°è€…æ¨¡å¼ï¼šåŠ¨æ€çš„å°†æ–°åŠŸèƒ½é™„åŠ åˆ°å¯¹è±¡ä¸Šã€‚åœ¨åŠŸèƒ½çš„æ‰©å±•æ–¹é¢æ¯”ç»§æ‰¿æ›´æœ‰å¼¹æ€§ï¼Œè£…é¥°è€…æ¨¡å¼ä¹Ÿä½“ç°å‹’å¼€é—­åŸåˆ™ï¼ˆoopï¼‰**



## **1ã€è£…é¥°è€…æ¨¡å¼è§£å†³æ˜Ÿå·´å…‹å’–å•¡è®¢å•**



- ![image-20200509180110583](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200509180110583.png)

  

é¥®æ–™æŠ½è±¡ç±»

```java
public abstract class Drink {
    public String description="";//é¥®æ–™çš„å…·ä½“æè¿°
    private float price = 0.0f; //é¥®æ–™çš„ä»·æ ¼

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    public float getPrice() {
        return price;
    }

    public void setPrice(float price) {
        this.price = price;
    }

    public abstract float cost();//è®¡ç®—ä»·æ ¼æŠ½è±¡æ–¹æ³• å…·ä½“ä»·æ ¼å…·ä½“ç±»å®ç°
}

```

Coffeeç±»

```java
public class Coffee extends Drink {

    @Override
    public float cost() {
        return super.getPrice();
    }
}

```

å…·ä½“çš„å’–å•¡ï¼šç¾å¼å’–å•¡

```java
public class LongBlack extends Coffee {
    public LongBlack() {
        setDescription("LongBlack");
        setPrice(12.0f);
    }
}
```

è£…é¥°è€…ï¼šè¿™é‡Œæ˜¯è°ƒå‘³å“

```java
public class Decorator extends Drink {
    private Drink obj;

    public Decorator(Drink obj){//jé€šè¿‡èšåˆå…³ç³»
        this.obj=obj;
    }

    @Override
    public float cost() {
        //è‡ªå·±çš„ä»·æ ¼ åŠ ä¸Šè¢«è£…é¥°è€…çš„ä»·æ ¼
        return super.getPrice()+obj.cost();
    }

    @Override
    public String getDescription() {
        //è£…é¥°è€…çš„æè¿°+è£…é¥°è€…çš„ä»·æ ¼+è¢«è£…é¥°è€…çš„æè¿°
        return super.getDescription()+" "+super.getPrice()+" &&"+obj.getDescription();
    }
}

```

å…·ä½“è°ƒæ–™ å·§å…‹åŠ›  ç‰›å¥¶

```java
public class Chocolate extends Decorator {

    public Chocolate(Drink obj) {
        super(obj);
        setDescription("å·§å…‹åŠ›");
        setPrice(2.0f);
    }
}

public class Milk extends  Decorator {

    public Milk(Drink obj) {
        super(obj);
        setDescription("milk");
        setPrice(1.5f);
    }
}
```

å®¢æˆ·ç«¯ä½¿ç”¨

```java
public class Client {
    public static void main(String[] args) {
        //ç‚¹ä¸€ä»½LongBlack
        Drink order = new LongBlack();
		//åŠ ä¸€ä»½å·§å…‹åŠ›
        order = new Chocolate(order);
        System.out.println("è´¹ç”¨ï¼š" + order.cost());
        System.out.println("æè¿°ï¼š" + order.getDescription());
        //åŠ ä¸€ä»½ç‰›å¥¶
        order = new Milk(order);
        System.out.println("è´¹ç”¨ï¼šå’–å•¡+å·§å…‹åŠ›+ç‰›å¥¶" + order.cost());
        System.out.println("æè¿°ï¼š" + order.getDescription());

    }
}
```

## 2ã€jdk ioæºç 

```java
public class jdk {
    public static void main(String[] args) throws Exception {
        //InputStream æ˜¯æŠ½è±¡ç±» ç±»ä¼¼äºDrink
        //FileInputStreamæ˜¯InputStreamçš„å­ç±»ï¼Œç±»ä¼¼å‰é¢çš„Coffee
        //FilterInputStreamæ˜¯InputStreamçš„å­ç±»ï¼Œ ç±»ä¼¼äºå‰é¢çš„Decorator è£…é¥°è€…
        // DataInputStreamæ˜¯FilterInputStreamçš„å­ç±»  å…·ä½“çš„è£…é¥°è€…ï¼Œç±»ä¼¼å‰é¢çš„Milk
        DataInputStream dis = new DataInputStream(new FileInputStream("D://a.txt"));
        System.out.println(dis.read());
        dis.close();
    }
}
```

# 7ã€ä»£ç†æ¨¡å¼

**ä»£ç†è®¾è®¡æ¨¡å¼ â€”> ç»“æ„å‹æ¨¡å¼**

**ä»£ç†æ¨¡å¼ï¼šä¸ºä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªæ›¿èº«ï¼Œä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ï¼Œå¯ä»¥è¯¦ç»†è®¿é—®æŸä¸ªå¯¹è±¡çš„æ–¹æ³•ã€‚å³é€šè¿‡ä»£ç†å¯¹è±¡è®¿é—®ç›®æ ‡å¯¹è±¡ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥åœ¨ç›®æ ‡å¯¹è±¡å®ç°çš„åŸºç¡€ä¸Šï¼Œå¢å¼ºé¢å¤–çš„åŠŸèƒ½æ“ä½œï¼Œå³æ‰©å±•ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ã€‚**

**åˆ†ç±»ï¼š**

- **é™æ€ä»£ç†**
- **åŠ¨æ€ä»£ç†ï¼ˆJDKä»£ç†ã€æ¥å£ä»£ç†ï¼‰â€” javaassist å­—èŠ‚ç æ“ä½œ**
- **CGLib ä»£ç†ï¼ˆCode Generation Libraryï¼ŒåŠ¨æ€ä»£ç†èŒƒç•´ï¼Œåœ¨å†…å­˜åŠ¨æ€åˆ›å»ºå¯¹è±¡ï¼Œä¸éœ€è¦å®ç°æ¥å£ï¼‰**

## 1ã€é™æ€ä»£ç†ï¼ˆStatic Proxyï¼‰

**é™æ€ä»£ç†åœ¨ä½¿ç”¨æ—¶ï¼Œéœ€è¦å®šä¹‰æ¥å£æˆ–è€…çˆ¶ç±»ï¼Œè¢«ä»£ç†å¯¹è±¡(å³ç›®æ ‡å¯¹è±¡)ä¸ä»£ç†å¯¹è±¡ä¸€èµ·å®ç°ç›¸åŒçš„æ¥å£æˆ–è€…æ˜¯ç»§æ‰¿ç›¸åŒçˆ¶ç±»ã€‚ç„¶åé€šè¿‡è°ƒç”¨ç›¸åŒçš„æ–¹æ³•æ¥è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ã€‚**

![image-20200511134011262](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200511134011262.png)

å®šä¹‰æ¥å£ static

```java
public interface ITeacherDao {
    void teach();
}
```

------

è¢«ä»£ç†å¯¹è±¡ static

```java
public class TeacherDao implements ITeacherDao {
    @Override
    public void teach() {
        System.out.println("è€å¸ˆæˆè¯¾ï¼");
    }
}
```

------

ä»£ç†å¯¹è±¡ static

```java
//é™æ€ä»£ç†
public class TeacherDaoProxy implements ITeacherDao {

    private TeacherDao target;

    //æ„é€ å™¨
    public TeacherDaoProxy(TeacherDao target) {
        this.target = target;
    }

    @Override
    public void teach() {
        System.out.println("ä»£ç†å¯¹è±¡...å¼€å§‹ï¼---> æå‰å®Œæˆä¸€äº›äº‹æƒ…ï¼");
        target.teach();//TODO æ‰§è¡Œç›®æ ‡æ–¹æ³•
        System.out.println("ä»£ç†å¯¹è±¡...ç»“æŸï¼---> æäº¤");
    }
}
```

------

ä½¿ç”¨ä»£ç†å¯¹è±¡ static

```java
public class Client {

    public static void main(String[] args) {

        //åˆ›å»ºç›®æ ‡ï¼Œè¢«ä»£ç†å¯¹è±¡
        TeacherDao teacherDao = new TeacherDao();

        //åˆ›å»º ä»£ç†å¯¹è±¡ï¼ŒåŒæ—¶æŠŠè¢«ä»£ç†å¯¹è±¡ä¼ ç»™ä»£ç†å¯¹è±¡
        TeacherDaoProxy teacherDaoProxy = new TeacherDaoProxy(teacherDao);

        //é€šè¿‡ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œè°ƒç”¨è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•
        teacherDaoProxy.teach();
    }
}

//TODO
ä»£ç†å¯¹è±¡...å¼€å§‹ï¼---> æå‰å®Œæˆä¸€äº›äº‹æƒ…ï¼
è€å¸ˆæˆè¯¾ï¼
ä»£ç†å¯¹è±¡...ç»“æŸï¼---> æäº¤
```

- **ä¼˜ç‚¹ï¼šåœ¨ä¸ä¿®æ”¹ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½å‰æä¸‹ï¼Œèƒ½é€šè¿‡ä»£ç†å¯¹è±¡å¯¹ç›®æ ‡åŠŸèƒ½æ‰©å±•ã€‚**
- **ç¼ºç‚¹ï¼šå› ä¸ºä»£ç†å¯¹è±¡éœ€è¦ä¸ç›®æ ‡å¯¹è±¡å®ç°ä¸€æ ·çš„æ¥å£ï¼Œæ‰€ä»¥ä¼šæœ‰å¾ˆå¤šä»£ç†ç±»ï¼Œä¸€æ—¦æ¥å£å¢åŠ æ–¹æ³•ï¼Œç›®æ ‡å¯¹è±¡ä¸ä»£ç†å¯¹è±¡éƒ½è¦ç»´æŠ¤ã€‚**

## 2ã€åŠ¨æ€ä»£ç†

**JDK åŠ¨æ€ä»£ç†ï¼ˆDynamic Proxyï¼‰**

**åŠ¨æ€ä»£ç†ä¹Ÿå«åšï¼šJDKä»£ç†ï¼ˆåå°„æœºåˆ¶ï¼‰ or æ¥å£ä»£ç†**

- **ä»£ç†ç±»æ‰€åœ¨åŒ…ï¼šjava.lang.reflect.Proxy**
  - JDK å®ç°ä»£ç†åªéœ€è¦ä½¿ç”¨ newProxyInstanceæ–¹æ³•ï¼Œä½†æ˜¯è¯¥æ–¹æ³•éœ€è¦æ¥å—ä¸‰ä¸ªå‚æ•°ã€‚
- **ä»£ç†å¯¹è±¡ï¼Œä¸éœ€è¦å®ç°æ¥å£ï¼Œä½†æ˜¯ç›®æ ‡å¯¹è±¡(è¢«ä»£ç†å¯¹è±¡)è¦å®ç°æ¥å£ï¼Œå¦åˆ™ä¸èƒ½ç”¨åŠ¨æ€ä»£ç†**ï¼›
- **ä»£ç†å¯¹è±¡çš„ç”Ÿæˆï¼Œæ˜¯åˆ©ç”¨ JDK çš„APIï¼ŒåŠ¨æ€çš„åœ¨å†…å­˜ä¸­æ„å»ºä»£ç†å¯¹è±¡ã€‚**
  - é€šè¿‡ä¸º Proxy ç±»æŒ‡å®š ClassLoader å¯¹è±¡å’Œä¸€ç»„ Class<?>[] interfacesæ¥åˆ›å»ºåŠ¨æ€ä»£ç†ï¼›
  - é€šè¿‡å®ç° InvocationHandler æ¥å£åˆ›å»ºè‡ªå·±çš„è°ƒç”¨å¤„ç†å™¨ï¼›
  - é€šè¿‡åå°„æœºåˆ¶è·å–åŠ¨æ€ä»£ç†ç±»çš„æ„é€ å‡½æ•°ï¼Œå…¶å”¯ä¸€å‚æ•°ç±»å‹å°±æ˜¯è°ƒç”¨å¤„ç†å™¨æ¥å£ç±»å‹ï¼›
  - é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºåŠ¨æ€ä»£ç†ç±»å®ä¾‹ï¼Œæ„é€ æ—¶è°ƒç”¨å¤„ç†å™¨å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ å…¥

**å®šä¹‰æ¥å£ Dynamic**

```java
public interface ITeachDao {
    void teach();
}

```

**è¢«ä»£ç†å¯¹è±¡ Dynamic**

```java
public class TeachDao implements ITeachDao {
    @Override
    public void teach() {
        System.out.println("teach.....");
    }
}
```

**ä»£ç†å¯¹è±¡ Dynamic**

```java
public class ProxyFactory {
    private Object target;

    public ProxyFactory(Object target) {
        this.target = target;
    }

    public Object getInstance() {
           /*
        public static Object newProxyInstance(ClassLoader loader,
                                          Class<?>[] interfaces,
                                          InvocationHandler h)
         */
        /**
         * 1ã€ClassLoader loaderï¼šæŒ‡å®šå½“å‰ç›®æ ‡å¯¹è±¡ä½¿ç”¨çš„ç±»åŠ è½½å™¨ï¼Œè·å–åŠ è½½å™¨çš„æ–¹æ³•å›ºå®š
         * 2ã€Class<?>[] interfacesï¼šç›®æ ‡å¯¹è±¡å®ç°çš„æ¥å£ç±»å‹ï¼Œä½¿ç”¨æ³›å‹æ–¹æ³•ç¡®å®ç±»å‹
         * 3ã€InvocationHandler hï¼šäº‹æƒ…å¤„ç†ï¼Œæ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œä¼šè§¦å‘äº‹ä»¶å¤„ç†å™¨æ–¹æ³•ï¼Œä¼šæŠŠå½“å‰æ‰§è¡Œçš„ç›®æ ‡å¯¹è±¡æ–¹æ³•ä½œä¸ºå‚æ•°ä¼ å…¥
         */
        return Proxy.newProxyInstance(target.getClass().getClassLoader(),
                target.getClass().getInterfaces(),
                new InvocationHandler() {
                    @Override
                    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
                        System.out.println("åŠ¨æ€ä»£ç†å¼€å§‹");
                        Object invoke = method.invoke(target, args);
                        System.out.println("åŠ¨æ€ä»£ç†ç»“æŸ");
                        return invoke;
                    }
                });
    }
```

**ä½¿ç”¨ä»£ç†å¯¹è±¡ Dynamic**

```java
public class Client {
    public static void main(String[] args) {
        //åˆ›å»ºç›®æ ‡ï¼Œè¢«ä»£ç†å¯¹è±¡
        ITeachDao teachDao = new TeachDao();
        //ç»™ç›®æ ‡å¯¹è±¡åˆ›å»ºä»£ç†å¯¹è±¡
        ProxyFactory proxyFactory = new ProxyFactory(teachDao);
        //è¿”å›ç”¨æ¥å£æ¥æ”¶ï¼Œå› ä¸ºåªæœ‰æ¥å£æ‰èƒ½ä¿è¯ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡æ–¹æ³•ä¸€è‡´
        ITeachDao instance = (ITeachDao) proxyFactory.getInstance();
        instance.teach();

    }
}
```

## 3ã€CGLib ä»£ç†ï¼ˆCode Generation Libraryï¼‰

**CGLib ä»£ç†ï¼ˆCode Generation Libraryï¼‰**

**é™æ€ä»£ç† å’Œ JDKä»£ç† éƒ½è¦æ±‚ç›®æ ‡å¯¹è±¡æ˜¯å®ç°ä¸€ä¸ªæ¥å£ï¼Œä½†æ˜¯æœ‰æ—¶å€™ç›®æ ‡å¯¹è±¡åªæ˜¯ä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡ï¼Œå¹¶æ²¡æœ‰å®ç°ä»»ä½•çš„æ¥å£ï¼Œè¿™ä¸ªæ—¶å€™å¯ä½¿ç”¨ç›®æ ‡å¯¹è±¡å­ç±»æ¥å®ç°ä»£ç†ï¼Œè¿™å°±æ˜¯Cglibä»£ç†ã€‚**

- **`CGLib ä»£ç†ä¹Ÿå«ä½œå­ç±»ä»£ç†ï¼ŒCGLibå¯ä»¥ä¸ºä¸€ä¸ªç±»åˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œåœ¨å­ç±»ä¸­é‡‡ç”¨æ–¹æ³•æ‹¦æˆªçš„æŠ€æœ¯æ‹¦æˆªæ‰€æœ‰çˆ¶ç±»æ–¹æ³•çš„è°ƒç”¨å¹¶é¡ºåŠ¿ç»‡å…¥æ¨ªåˆ‡é€»è¾‘`ã€‚åœ¨å†…å­˜ä¸­æ„å»ºä¸€ä¸ªå­ç±»å¯¹è±¡ä»è€Œå®ç°å¯¹ç›®æ ‡å¯¹è±¡åŠŸèƒ½æ‰©å±•ï¼Œæœ‰äº›ä¹¦ä¹Ÿå°†CGLib ä»£ç†å½’å±åˆ°åŠ¨æ€ä»£ç†ã€‚**
- **CGLib æ˜¯ä¸€ä¸ªå¼ºå¤§çš„é«˜æ€§èƒ½çš„ä»£ç ç”ŸæˆåŒ…ï¼Œå®ƒå¯ä»¥åœ¨è¿è¡ŒæœŸæ‰©å±• javaç±» ä¸ å®ç°javaæ¥å£ã€‚å®ƒå¹¿æ³›çš„è¢«è®¸å¤šAOPçš„æ¡†æ¶ä½¿ç”¨ï¼Œä¾‹å¦‚Spring AOPï¼Œå®ç°æ–¹æ³•æ‹¦æˆªã€‚**
- åœ¨AOPç¼–ç¨‹ä¸­å¦‚ä½•é€‰æ‹©ä»£ç†æ¨¡å¼
  - **ç›®æ ‡å¯¹è±¡éœ€è¦å®ç°æ¥å£ï¼Œç”¨JDKä»£ç†**ï¼›
  - **ç›®æ ‡å¯¹è±¡ä¸éœ€è¦å®ç°æ¥å£ï¼Œç”¨CGLibä»£ç†**ï¼›
- **CGLibåŒ…çš„åº•å±‚æ˜¯é€šè¿‡ä½¿ç”¨å­—èŠ‚ç å¤„ç†æ¡†æ¶ASMæ¥è½¬æ¢å­—èŠ‚ç å¹¶ç”Ÿæˆæ–°çš„ç±»ã€‚**

------

**ä½¿ç”¨**

- **1ã€éœ€è¦ CGLib Jar åŒ…ï¼›**
- **`2ã€åœ¨å†…å­˜ä¸­åŠ¨æ€æ„å»ºå­ç±»ï¼Œæ³¨æ„ä»£ç†çš„ç±»ä¸èƒ½ä¸º Finalï¼Œå¦åˆ™æŠ¥é”™ã€‚`**
  - **java.lang. llgalArgumentException**
- **`3ã€ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•å¦‚æœä¸º final/staticï¼Œé‚£ä¹ˆå°±ä¸ä¼šè¢«æ‹¦æˆªï¼Œå³ä¸ä¼šæ‰§è¡Œç›®æ ‡å¯¹è±¡é¢å¤–çš„ä¸šåŠ¡æ–¹æ³•ã€‚`**

![image-20200511162930126](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200511162930126.png)

**å¼•å…¥ Jar åŒ…**

```java
<!--CGLib åŠ¨æ€ä»£ç†-->
<dependency>
    <groupId>cglib</groupId>
    <artifactId>cglib</artifactId>
    <version>3.1</version>
</dependency>
```

**è¢«ä»£ç†å¯¹è±¡ CGLib**

```java
public class TeacherDao {

    public void teach() {
        System.out.println("è€å¸ˆæˆè¯¾ï¼");
    }

    public String write(String name) {
        System.out.println("name:" + name);
        return "successï¼";
    }
}
```

------

**ä»£ç†å¯¹è±¡ CGLib**

```java
import net.sf.cglib.proxy.Enhancer;
import net.sf.cglib.proxy.MethodInterceptor;
import net.sf.cglib.proxy.MethodProxy;

import java.lang.reflect.Method;

public class ProxyFactory implements MethodInterceptor {

    //ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡ï¼ŒObject
    private Object target;

    //æ„é€ å™¨ï¼Œå¯¹targetè¿›è¡Œåˆå§‹åŒ–
    public ProxyFactory(Object target) {
        this.target = target;
    }

    //è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œæ˜¯targetå¯¹è±¡çš„ä»£ç†å¯¹è±¡
    public Object getProxyInstance() {
        //1ã€åˆ›å»ºä¸€ä¸ªå·¥å…·ç±»
        Enhancer enhancer = new Enhancer();
        //2ã€è®¾ç½®çˆ¶ç±»
        enhancer.setSuperclass(target.getClass());
        //3ã€è®¾ç½®å›è°ƒå‡½æ•°
        enhancer.setCallback(this);
        //4ã€åˆ›å»ºå­ç±»å¯¹è±¡ï¼Œå³ä»£ç†å¯¹è±¡
        return enhancer.create();
    }

    @Override
    public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable {
        System.out.println("CGLib ä»£ç†ï¼");
        Object invoke = method.invoke(target, objects);
        System.out.println("CGLib ä»£ç†ç»“æŸï¼");
        return invoke;
    }
}
```

------

**ä½¿ç”¨ä»£ç†å¯¹è±¡ CGLib**

```java
public class Client {
    public static void main(String[] args) {

        //åˆ›å»ºç›®æ ‡ï¼Œè¢«ä»£ç†å¯¹è±¡
        TeacherDao target = new TeacherDao();

        //åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå°†ç›®æ ‡å¯¹è±¡ä¼ é€’ç»™ä»£ç†å¯¹è±¡
        TeacherDao proxyInstance = (TeacherDao) new ProxyFactory(target).getProxyInstance();

        System.out.println(proxyInstance.getClass());
        proxyInstance.teach();

    }
}


```

### ä»£ç†å˜ä½“

- é˜²ç«å¢™ä»£ç†ï¼šå†…ç½‘é€šè¿‡ä»£ç†ç©¿é€é˜²ç«å¢™ï¼Œå®ç°å¯¹å…¬ç½‘çš„è®¿é—®ã€‚
- ç¼“å­˜ä»£ç†ï¼šå½“è¯·æ±‚å›¾ç‰‡æ–‡ä»¶ç­‰èµ„æºæ—¶ï¼Œå…ˆåˆ°ç¼“å­˜ä»£ç†å–ï¼Œå¦‚æœå–åˆ°èµ„æºåˆ™okï¼Œå¦‚æœå–ä¸åˆ°èµ„æºï¼Œå†åˆ°å…¬ç½‘æˆ–è€…æ•°æ®åº“å–ï¼Œç„¶åç¼“å­˜ã€‚
- è¿œç¨‹ä»£ç†ï¼šè¿œç¨‹å¯¹è±¡çš„æœ¬åœ°ä»£è¡¨ï¼Œé€šè¿‡å®ƒå¯ä»¥æŠŠè¿œç¨‹å¯¹è±¡å½“æœ¬åœ°å¯¹è±¡æ¥è°ƒç”¨ã€‚è¿œç¨‹ä»£ç†é€šè¿‡ç½‘ç»œå’ŒçœŸæ­£çš„è¿œç¨‹å¯¹è±¡æ²Ÿé€šä¿¡æ¯ã€‚
- å®‰å…¨ä»£ç†ï¼šå±è”½å¯¹çœŸå®è§’è‰²çš„ç›´æ¥è®¿é—®ã€‚
- å»¶è¿ŸåŠ è½½ï¼šå…ˆåŠ è½½è½»é‡çº§çš„ä»£ç†å¯¹è±¡ï¼ŒçœŸæ­£éœ€è¦å†åŠ è½½çœŸå®å¯¹è±¡ã€‚
- åŒæ­¥ä»£ç†ï¼šä¸»è¦ä½¿ç”¨åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œå®Œæˆå¤šçº¿ç¨‹é—´åŒæ­¥å·¥ä½œã€‚

# 8ã€è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼

**è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼ â€”> è¡Œä¸ºå‹æ¨¡å¼**

**è§‚å¯Ÿè€…æ¨¡å¼ï¼šå¯¹è±¡ä¹‹é—´å¤šå¯¹ä¸€ä¾èµ–çš„ä¸€ç§è®¾è®¡æ–¹æ¡ˆï¼Œè¢«ä¾èµ–çš„å¯¹è±¡ä¸º Subjectï¼Œä¾èµ–çš„å¯¹è±¡ä¸º Observerã€‚**

**Subject é€šçŸ¥ Observer å˜åŒ–ã€‚**

- **Observerï¼šæ¥æ”¶è¾“å…¥**
- **Subjectï¼šç™»è®°æ³¨å†Œã€ç§»é™¤å’Œé€šçŸ¥**
  - **registerObserverï¼šæ³¨å†Œ**
  - **removeObserverï¼šç§»é™¤**
  - **notifyObservers()ï¼šé€šçŸ¥æ‰€æœ‰æ³¨å†Œç”¨æˆ·ï¼Œå¯ä»¥æ›´æ–°æ•°æ®ï¼Œè®©ä¸»åŠ¨è·å–ï¼Œä¹Ÿå¯ä»¥ Subject æ—¶æ—¶æ¨é€ã€‚**

![image-20200511205158698](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200511205158698.png)

**Subject**

```java
public interface Subject {
    void registerObserver(Observer o);

    void removeObserver(Observer o);

    void notifyObserver();
}
```

**Observer**

```java
public interface Observer {
    void update(float temperature,float pressure,float humidity);
}
```

**WeatherData**

```java
public class WeatherData implements Subject {
    private float temperature;
    private float pressure;
    private float humidity;
    private ArrayList<Observer> observers;//è§‚å¯Ÿè€…é›†åˆ

    public WeatherData() {
        observers = new ArrayList<Observer>();
    }

    public float getTemperature() {
        return temperature;
    }

    public float getPressure() {
        return pressure;
    }

    public float getHumidity() {
        return humidity;
    }

    public void seData(float temperature, float pressure, float humidity) {
        this.temperature = temperature;
        this.pressure = pressure;
        this.humidity = humidity;
        notifyObserver();//æ¨é€æ‰€æœ‰è§‚å¯Ÿè€… æ•°æ®æ›´æ–°
    }

    @Override
    public void registerObserver(Observer o) {
        observers.add(o);
    }

    @Override
    public void removeObserver(Observer o) {
        if (observers.contains(o)) {
            observers.remove(o);
        }
    }
	
    //æ¨é€æ‰€æœ‰
    @Override
    public void notifyObserver() {
        for (int i = 0; i < observers.size(); i++) {
            observers.get(i).update(this.temperature, this.pressure, this.humidity);
        }
    }
}
```

**CurrentConditions**

```java
public class CurrentConditions implements Observer {
    private float temperature;
    private float pressure;
    private float humidity;

    //æ›´æ–°æ•°æ®
    @Override
    public void update(float temperature, float pressure, float humidity) {
        this.temperature = temperature;
        this.pressure = pressure;
        this.humidity = humidity;
        dispaly();
    }
    //å±•ç¤ºæ•°æ®
    private void dispaly() {
        System.out.println("============CurrentConditions data==========");
        System.out.println("today temperature =" + temperature);
        System.out.println("today pressure =" + pressure);
        System.out.println("today humidity=" + humidity);
    }

}



public class OtherCurrentConditions implements Observer {
    private float temperature;
    private float pressure;
    private float humidity;

    //æ›´æ–°æ•°æ®
    @Override
    public void update(float temperature, float pressure, float humidity) {
        this.temperature = temperature;
        this.pressure = pressure;
        this.humidity = humidity;
        dispaly();
    }
    //å±•ç¤ºæ•°æ®
    private void dispaly() {
        System.out.println("============OtherCurrentConditions data==========");
        System.out.println("today temperature =" + temperature);
        System.out.println("today pressure =" + pressure);
        System.out.println("today humidity=" + humidity);
    }
}
```

**Client**

```java
public class Client {
    public static void main(String[] args) {
        //åˆ›å»º Subject WeatherData æ•°æ®æº
        WeatherData weatherData = new WeatherData();
        //åˆ›å»ºè§‚å¯Ÿè€… Observer
        Observer currentConditions = new CurrentConditions();
        Observer otherCurrentConditions = new OtherCurrentConditions();

        //æŠŠè§‚å¯Ÿè€…æ³¨å†Œè¿› Subject
        weatherData.registerObserver(currentConditions);
        weatherData.registerObserver(otherCurrentConditions);

        System.out.println("========æ›´æ–°æ•°æ®ï¼Œå¹¶é€šçŸ¥è§‚å¯Ÿè€…========");
        weatherData.seData(20f,20f,133f);


        weatherData.removeObserver(currentConditions);
        System.out.println("=======Remove CurrentConditions=======");
        weatherData.notifyObserver();
    }
}
```

### è§‚å¯Ÿè€…æ¨¡å¼ JDK åº”ç”¨æºç åˆ†æ

![image-20200511212249538](https://gitee.com/chen_yi_fenga/blog-imag/raw/master/image-20200511212249538.png)